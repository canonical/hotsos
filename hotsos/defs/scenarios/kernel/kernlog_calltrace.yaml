checks:
  has_stacktraces: |
    len(@hotsos.core.plugins.kernel.CallTraceManager.calltrace_anytype) > 0
  has_oom_killer_invoked: |
    len(@hotsos.core.plugins.kernel.CallTraceManager.oom_killer) > 0
  has_bcache_deadlock_invoked: |
    len(@hotsos.core.plugins.kernel.CallTraceManager.calltrace-bcache) > 0
  has_hungtasks: |
    len(@hotsos.core.plugins.kernel.CallTraceManager.calltrace_hungtask) > 0
  has_fanotify_hang: |
    len(@hotsos.core.plugins.kernel.CallTraceManager.calltrace-fanotify) > 0
conclusions:
  stacktraces:
    # Give this one lowest priority so that if any other call trace types match they
    # take precedence.
    priority: 1
    decision: has_stacktraces
    raises:
      type: KernelError
      message: >-
        {numreports} reports of stacktraces in kern.log - please check.
      format-dict:
        numreports: hotsos.core.plugins.kernel.CallTraceManager.calltrace_anytype:len
  oom-killer-invoked:
    priority: 2
    decision: has_oom_killer_invoked
    raises:
      type: MemoryWarning
      message: >-
        {numreports} reports of oom-killer invoked in kern.log - please check.
      format-dict:
        numreports: hotsos.core.plugins.kernel.CallTraceManager.oom_killer:len
  bcache-deadlock-invoked:
    priority: 2
    decision: has_bcache_deadlock_invoked
    raises:
      type: MemoryWarning
      message: >-
        Bcache cache set registration deadlock has occurred. This is caused
        by a bug that has been fixed in kernel 5.15.11 (current is {kver}).
        See https://www.spinics.net/lists/stable/msg566639.html for full
        detail.
      format-dict:
        kver: hotsos.core.plugins.kernel.KernelBase.version
  hungtasks:
    priority: 2
    decision: has_hungtasks
    raises:
      type: KernelError
      message: >-
        {numreports} reports of hung tasks in kern.log - please check.
      format-dict:
        numreports: hotsos.core.plugins.kernel.CallTraceManager.calltrace_hungtask:len
  fanotify_hangs:
    priority: 2
    decision: has_fanotify_hang
    raises:
      type: KernelError
      message: >-
        {numreports} reports of fanotify related hangs in kern.log. This may
        be related to antivirus software running in the system.
      format-dict:
        numreports: hotsos.core.plugins.kernel.CallTraceManager.calltrace-fanotify:len
