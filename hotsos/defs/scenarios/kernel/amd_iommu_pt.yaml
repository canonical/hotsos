checks:
  not_using_iommu_passthrough_for_suitable_amd: |
    (@hotsos.core.plugins.kernel.sysfs.CPU.vendor == 'authenticamd') AND
    (@hotsos.core.plugins.system.SystemBase.virtualisation_type == None) AND
    NOT('iommu=pt' IN @hotsos.core.plugins.kernel.KernelBase.boot_parameters)
conclusions:
  mixed-pkg-releases:
    decision:
      - not_using_iommu_passthrough_for_suitable_amd
    raises:
      type: SystemWarning
      message: >-
        This host is using an {cpu_model} cpu but is not using iommu
        passthrough mode (e.g. set iommu=pt in boot parameters) which is
        recommended in order to get the best performance e.g. for networking.
      format-dict:
        cpu_model: hotsos.core.plugins.kernel.sysfs.CPU.model
