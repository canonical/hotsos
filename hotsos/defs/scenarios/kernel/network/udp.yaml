checks:
  rcvbuferrors_high: |
    @hotsos.core.plugins.kernel.net.SNMPUdp.RcvbufErrors > 500 OR
    @hotsos.core.plugins.kernel.net.SNMPUdp.RcvbufErrorsPcentInDatagrams > 1
  sndbuferrors_high: |
    @hotsos.core.plugins.kernel.net.SNMPUdp.SndbufErrors > 500 OR
    @hotsos.core.plugins.kernel.net.SNMPUdp.SndbufErrorsPcentOutDatagrams > 1
  inerrs_high_pcent_or_above_limit: |
    @hotsos.core.plugins.kernel.net.SNMPUdp.InErrors > 500 OR
    @hotsos.core.plugins.kernel.net.SNMPUdp.InErrorsPcentInDatagrams > 1
  incsumerrs_high_or_above_limit: |
    @hotsos.core.plugins.kernel.net.SNMPUdp.InCsumErrors > 500 OR
    @hotsos.core.plugins.kernel.net.SNMPUdp.InCsumErrorsPcentInDatagrams > 1
  memusage_pct_high: |
    @hotsos.core.plugins.kernel.net.SockStat.UDPMemUsagePct > 85
  memusage_pct_exhausted: |
    @hotsos.core.plugins.kernel.net.SockStat.UDPMemUsagePct >= 100
conclusions:
  inerrs_high_pcent_or_above_limit:
    decision: inerrs_high_pcent_or_above_limit
    raises:
      type: KernelWarning
      message: >-
        UDP ingress errors are at {count} ({pcent}% of total datagrams).
      format-dict:
        count: hotsos.core.plugins.kernel.net.SNMPUdp.InErrors
        pcent: hotsos.core.plugins.kernel.net.SNMPUdp.InErrorsPcentInDatagrams
  incsumerrs_high_or_above_limit:
    decision: incsumerrs_high_or_above_limit
    raises:
      type: KernelWarning
      message: >-
        UDP ingress checksum errors are at {count} ({pcent}% of total datagrams). This could
        mean that one or more interfaces are experiencing hardware errors.
      format-dict:
        count: hotsos.core.plugins.kernel.net.SNMPUdp.InCsumErrors
        pcent: hotsos.core.plugins.kernel.net.SNMPUdp.InCsumErrorsPcentInDatagrams
  rcvbuferrors_high:
    decision: rcvbuferrors_high
    raises:
      type: KernelWarning
      message: >-
        UDP receive buffer errors are at {count} ({pcent}% of total rx).
      format-dict:
        count: hotsos.core.plugins.kernel.net.SNMPUdp.RcvbufErrors
        pcent: hotsos.core.plugins.kernel.net.SNMPUdp.RcvbufErrorsPcentInDatagrams
  sndbuferrors_high:
    decision: sndbuferrors_high
    raises:
      type: KernelWarning
      message: >-
        UDP send buffer errors are at {count} ({pcent}% of total tx).
      format-dict:
        count: hotsos.core.plugins.kernel.net.SNMPUdp.SndbufErrors
        pcent: hotsos.core.plugins.kernel.net.SNMPUdp.SndbufErrorsPcentOutDatagrams
  memusage_pct_high:
    decision:
      - memusage_pct_high
      - not: memusage_pct_exhausted
    raises:
      type: KernelWarning
      message: >-
        UDP memory page usage is high ({pct}%), ({pa} out of {pm} mem pages are in use).
        Kernel will start to drop UDP frames if all pages are exhausted.
      format-dict:
        pa: hotsos.core.plugins.kernel.net.SockStat.GlobUdpSocksTotalMemPages
        pm: hotsos.core.plugins.kernel.net.SockStat.SysctlUdpMemMax
        pct: hotsos.core.plugins.kernel.net.SockStat.UDPMemUsagePct
  memusage_pct_exhausted:
    decision: memusage_pct_exhausted
    raises:
      type: KernelWarning
      message: >-
        All UDP memory pages are exhausted! ({pa} out of {pm} mem pages are in use).
        Kernel will drop UDP packets, expect packet losses on ALL UDP transport!
      format-dict:
        pa: hotsos.core.plugins.kernel.net.SockStat.GlobUdpSocksTotalMemPages
        pm: hotsos.core.plugins.kernel.net.SockStat.SysctlUdpMemMax
        pct: hotsos.core.plugins.kernel.net.SockStat.UDPMemUsagePct
