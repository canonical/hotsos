2025-05-14T04:25:14.955Z [pebble] HTTP API server listening on ":38812".
2025-05-14T04:25:14.955Z [pebble] Started daemon.
2025-05-14T04:25:15.130Z [pebble] POST /v1/services 167.703163ms 202
2025-05-14T04:25:15.190Z [pebble] Service "container-agent" starting: /charm/bin/containeragent unit --data-dir /var/lib/juju --append-env "PATH=$PATH:/charm/bin" --show-log --charm-modified-version 0
2025-05-14T04:25:15.660Z [container-agent] 2025-05-14 04:25:15 INFO juju.cmd supercommand.go:56 running containerAgent [3.6.5 33b026f4ab2a4fe371764b9c41993d3e1e90ddef gc go1.24.1]
2025-05-14T04:25:15.662Z [container-agent] starting containeragent unit command
2025-05-14T04:25:15.662Z [container-agent] containeragent unit "unit-neutron-mysql-router-0" start (3.6.5 [gc])
2025-05-14T04:25:15.669Z [container-agent] 2025-05-14 04:25:15 INFO juju.cmd.containeragent.unit runner.go:592 start "unit"
2025-05-14T04:25:15.669Z [container-agent] 2025-05-14 04:25:15 INFO juju.worker.upgradesteps worker.go:60 upgrade steps for 3.6.5 have already been run.
2025-05-14T04:25:15.774Z [container-agent] 2025-05-14 04:25:15 INFO juju.worker.probehttpserver server.go:157 starting http server on 127.0.0.1:65301
2025-05-14T04:25:15.870Z [container-agent] 2025-05-14 04:25:15 INFO juju.api apiclient.go:979 cannot resolve "controller-service.controller-sunbeam-controller.svc.cluster.local": lookup controller-service.controller-sunbeam-controller.svc.cluster.local on 10.152.183.193:53: dial udp 10.152.183.193:53: connect: operation not permitted
2025-05-14T04:25:15.951Z [container-agent] 2025-05-14 04:25:15 INFO juju.api apiclient.go:601 connection established to "wss://172.16.1.201:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T04:25:15.972Z [container-agent] 2025-05-14 04:25:15 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-neutron-mysql-router-0" successfully connected to "wss://172.16.1.201:17070"
2025-05-14T04:25:16.011Z [container-agent] 2025-05-14 04:25:16 INFO juju.worker.migrationminion worker.go:208 migration phase is now: NONE
2025-05-14T04:25:16.123Z [container-agent] 2025-05-14 04:25:16 INFO juju.worker.logger logger.go:120 logger worker started
2025-05-14T04:25:16.155Z [container-agent] 2025-05-14 04:25:16 WARNING juju.worker.proxyupdater proxyupdater.go:237 unable to set snap core settings [proxy.http= proxy.https= proxy.store=]: exec: "snap": executable file not found in $PATH, output: ""
2025-05-14T04:25:16.155Z [container-agent] 2025-05-14 04:25:16 INFO juju.worker.leadership tracker.go:244 neutron-mysql-router/0 promoted to leadership of neutron-mysql-router
2025-05-14T04:25:16.176Z [container-agent] 2025-05-14 04:25:16 INFO juju.worker.caasupgrader upgrader.go:113 abort check blocked until version event received
2025-05-14T04:25:16.182Z [container-agent] 2025-05-14 04:25:16 INFO juju.worker.caasupgrader upgrader.go:119 unblocking abort check
2025-05-14T04:25:16.252Z [pebble] GET /v1/changes/59/wait 1.098500993s 200
2025-05-14T04:25:16.253Z [pebble] Started default services with change 59.
2025-05-14T04:25:16.292Z [container-agent] 2025-05-14 04:25:16 INFO juju.agent.tools symlinks.go:20 ensure jujuc symlinks in /var/lib/juju/tools/unit-neutron-mysql-router-0
2025-05-14T04:25:17.208Z [container-agent] 2025-05-14 04:25:17 INFO juju.worker.uniter uniter.go:365 unit "neutron-mysql-router/0" started
2025-05-14T04:25:17.297Z [container-agent] 2025-05-14 04:25:17 INFO juju.worker.uniter uniter.go:391 hooks are retried true
2025-05-14T04:25:18.016Z [container-agent] 2025-05-14 04:25:18 INFO juju.worker.uniter resolver.go:76 reboot detected; triggering implicit start hook to notify charm
2025-05-14T04:25:25.075Z [pebble] Check "readiness" failure 1/3: non-2xx status code 418
2025-05-14T04:25:35.138Z [pebble] Check "readiness" failure 2/3: non-2xx status code 418
2025-05-14T04:25:42.163Z [container-agent] 2025-05-14 04:25:42 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:25:42.739Z [container-agent] 2025-05-14 04:25:42 INFO juju-log Enabling MySQL Router service
2025-05-14T04:25:45.018Z [pebble] Check "readiness" failure 3/3: non-2xx status code 418
2025-05-14T04:25:45.018Z [pebble] Check "readiness" threshold 3 hit, triggering action and recovering
2025-05-14T04:25:45.020Z [pebble] Change 57 task (Perform HTTP check "readiness") failed: non-2xx status code 418
2025-05-14T04:25:46.135Z [container-agent] 2025-05-14 04:25:46 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T04:25:46.145Z [container-agent] import json
2025-05-14T04:25:46.145Z [container-agent] import mysqlsh
2025-05-14T04:25:46.145Z [container-agent] import traceback
2025-05-14T04:25:46.145Z [container-agent] 
2025-05-14T04:25:46.145Z [container-agent] try:
2025-05-14T04:25:46.145Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T04:25:46.145Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T04:25:46.145Z [container-agent]     import json
2025-05-14T04:25:46.145Z [container-agent] 
2025-05-14T04:25:46.145Z [container-agent]     result = session.run_sql(
2025-05-14T04:25:46.145Z [container-agent]         "SELECT USER, ATTRIBUTE->>'$.router_id' FROM INFORMATION_SCHEMA.USER_ATTRIBUTES WHERE ATTRIBUTE->'$.created_by_user'='relation-83_ee070cdf4b8b49' AND ATTRIBUTE->'$.created_by_juju_unit'='neutron-mysql-router/0'"
2025-05-14T04:25:46.145Z [container-agent]     )
2025-05-14T04:25:46.145Z [container-agent]     rows = result.fetch_all()
2025-05-14T04:25:46.145Z [container-agent]     # mysqlsh objects are weirdâ€”they quack (i.e. duck typing) like standard Python objects (e.g. list,
2025-05-14T04:25:46.145Z [container-agent]     # dict), but do not serialize to JSON correctly.
2025-05-14T04:25:46.145Z [container-agent]     # Cast to str & load from JSON str before serializing
2025-05-14T04:25:46.145Z [container-agent]     rows = json.loads(str(rows))
2025-05-14T04:25:46.145Z [container-agent]     with open("/tmp/mysqlsh_output.json", "w") as file:
2025-05-14T04:25:46.145Z [container-agent]         json.dump(rows, file)
2025-05-14T04:25:46.145Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T04:25:46.145Z [container-agent]     error = {
2025-05-14T04:25:46.145Z [container-agent]         "message": str(exception),
2025-05-14T04:25:46.145Z [container-agent]         "code": exception.code,
2025-05-14T04:25:46.145Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T04:25:46.145Z [container-agent]     }
2025-05-14T04:25:46.145Z [container-agent] else:
2025-05-14T04:25:46.145Z [container-agent]     error = None
2025-05-14T04:25:46.145Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T04:25:46.145Z [container-agent]     json.dump(error, file)
2025-05-14T04:25:46.145Z [container-agent] 
2025-05-14T04:25:46.145Z [container-agent] stderr:
2025-05-14T04:25:46.145Z [container-agent] Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory
2025-05-14T04:25:46.145Z [container-agent] MySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (111)
2025-05-14T04:25:46.145Z [container-agent] 
2025-05-14T04:25:46.145Z [container-agent] Traceback (most recent call last):
2025-05-14T04:25:46.145Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T04:25:46.145Z [container-agent]     output, _ = process.wait_output()
2025-05-14T04:25:46.145Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T04:25:46.145Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T04:25:46.145Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (111)\n"
2025-05-14T04:25:46.145Z [container-agent] 
2025-05-14T04:25:46.145Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T04:25:46.145Z [container-agent] 
2025-05-14T04:25:46.145Z [container-agent] Traceback (most recent call last):
2025-05-14T04:25:46.145Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T04:25:46.145Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T04:25:46.145Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:25:46.146Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:25:46.146Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T04:25:46.146Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T04:25:46.146Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:25:46.146Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:25:46.146Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T04:25:46.146Z [container-agent]     raise container.CalledProcessError(
2025-05-14T04:25:46.146Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T04:25:46.372Z [container-agent] 2025-05-14 04:25:46 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T04:25:46.373Z [container-agent] Traceback (most recent call last):
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T04:25:46.373Z [container-agent]     output, _ = process.wait_output()
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T04:25:46.373Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T04:25:46.373Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (111)\n"
2025-05-14T04:25:46.373Z [container-agent] 
2025-05-14T04:25:46.373Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T04:25:46.373Z [container-agent] 
2025-05-14T04:25:46.373Z [container-agent] Traceback (most recent call last):
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T04:25:46.373Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T04:25:46.373Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T04:25:46.373Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T04:25:46.373Z [container-agent]     framework._emit(event)
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T04:25:46.373Z [container-agent]     self._reemit(event_path)
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T04:25:46.373Z [container-agent]     custom_handler(event)
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:25:46.373Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 355, in reconcile
2025-05-14T04:25:46.373Z [container-agent]     workload_.reconcile(
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:25:46.373Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 399, in reconcile
2025-05-14T04:25:46.373Z [container-agent]     self._enable_router(event=event, tls=tls, unit_name=unit_name)
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:25:46.373Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 331, in _enable_router
2025-05-14T04:25:46.373Z [container-agent]     self._cleanup_after_upgrade_or_potential_container_restart()
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:25:46.373Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 228, in _cleanup_after_upgrade_or_potential_container_restart
2025-05-14T04:25:46.373Z [container-agent]     if user_info := self.shell.get_mysql_router_user_for_unit(self._charm.unit.name):
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 167, in get_mysql_router_user_for_unit
2025-05-14T04:25:46.373Z [container-agent]     self._run_code(
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T04:25:46.373Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:25:46.373Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T04:25:46.373Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:25:46.373Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:25:46.373Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T04:25:46.373Z [container-agent]     raise container.CalledProcessError(
2025-05-14T04:25:46.373Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T04:25:47.832Z [container-agent] 2025-05-14 04:25:47 ERROR juju.worker.uniter.operation runhook.go:180 hook "start" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T04:25:47.844Z [container-agent] 2025-05-14 04:25:47 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:25:52.896Z [container-agent] 2025-05-14 04:25:52 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:25:55.129Z [pebble] Check "readiness" failure 4/3: non-2xx status code 418
2025-05-14T04:26:05.115Z [pebble] Check "readiness" failure 5/3: non-2xx status code 418
2025-05-14T04:26:11.994Z [container-agent] 2025-05-14 04:26:11 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:26:12.388Z [container-agent] 2025-05-14 04:26:12 INFO juju-log Enabling MySQL Router service
2025-05-14T04:26:15.147Z [pebble] Check "readiness" failure 6/3: non-2xx status code 418
2025-05-14T04:26:17.947Z [container-agent] 2025-05-14 04:26:17 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T04:26:17.947Z [container-agent] import json
2025-05-14T04:26:17.947Z [container-agent] import mysqlsh
2025-05-14T04:26:17.947Z [container-agent] import traceback
2025-05-14T04:26:17.947Z [container-agent] 
2025-05-14T04:26:17.947Z [container-agent] try:
2025-05-14T04:26:17.947Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T04:26:17.947Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T04:26:17.947Z [container-agent]     session.run_sql("DROP USER `mysql_router4_ld6qip4`")
2025-05-14T04:26:17.947Z [container-agent] 
2025-05-14T04:26:17.947Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T04:26:17.947Z [container-agent]     error = {
2025-05-14T04:26:17.947Z [container-agent]         "message": str(exception),
2025-05-14T04:26:17.947Z [container-agent]         "code": exception.code,
2025-05-14T04:26:17.947Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T04:26:17.947Z [container-agent]     }
2025-05-14T04:26:17.947Z [container-agent] else:
2025-05-14T04:26:17.947Z [container-agent]     error = None
2025-05-14T04:26:17.947Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T04:26:17.947Z [container-agent]     json.dump(error, file)
2025-05-14T04:26:17.947Z [container-agent] 
2025-05-14T04:26:17.947Z [container-agent] MySQL client error 1290
2025-05-14T04:26:17.947Z [container-agent] MySQL Shell traceback:
2025-05-14T04:26:17.947Z [container-agent] Traceback (most recent call last):
2025-05-14T04:26:17.947Z [container-agent]   File "<string>", line 8, in <module>
2025-05-14T04:26:17.947Z [container-agent] mysqlsh.DBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:26:17.948Z [container-agent] 
2025-05-14T04:26:17.948Z [container-agent] Traceback (most recent call last):
2025-05-14T04:26:17.948Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:26:17.948Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:26:17.948Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:26:18.044Z [container-agent] 2025-05-14 04:26:18 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T04:26:18.045Z [container-agent] Traceback (most recent call last):
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T04:26:18.045Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T04:26:18.045Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T04:26:18.045Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T04:26:18.045Z [container-agent]     framework._emit(event)
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T04:26:18.045Z [container-agent]     self._reemit(event_path)
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T04:26:18.045Z [container-agent]     custom_handler(event)
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:26:18.045Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 355, in reconcile
2025-05-14T04:26:18.045Z [container-agent]     workload_.reconcile(
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:26:18.045Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 399, in reconcile
2025-05-14T04:26:18.045Z [container-agent]     self._enable_router(event=event, tls=tls, unit_name=unit_name)
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:26:18.045Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 331, in _enable_router
2025-05-14T04:26:18.045Z [container-agent]     self._cleanup_after_upgrade_or_potential_container_restart()
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:26:18.045Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 230, in _cleanup_after_upgrade_or_potential_container_restart
2025-05-14T04:26:18.045Z [container-agent]     self.shell.delete_user(user_info.username)
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 207, in delete_user
2025-05-14T04:26:18.045Z [container-agent]     self._run_sql([statement])
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 113, in _run_sql
2025-05-14T04:26:18.045Z [container-agent]     self._run_code(
2025-05-14T04:26:18.045Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:26:18.045Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:26:18.045Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:26:18.829Z [container-agent] 2025-05-14 04:26:18 ERROR juju.worker.uniter.operation runhook.go:180 hook "start" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T04:26:18.834Z [container-agent] 2025-05-14 04:26:18 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:26:25.152Z [pebble] Check "readiness" failure 7/3: non-2xx status code 418
2025-05-14T04:26:28.761Z [container-agent] 2025-05-14 04:26:28 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:26:35.123Z [pebble] Check "readiness" failure 8/3: non-2xx status code 418
2025-05-14T04:26:41.688Z [container-agent] 2025-05-14 04:26:41 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:26:42.032Z [container-agent] 2025-05-14 04:26:42 INFO juju-log Enabling MySQL Router service
2025-05-14T04:26:45.144Z [pebble] Check "readiness" failure 9/3: non-2xx status code 418
2025-05-14T04:26:47.886Z [container-agent] 2025-05-14 04:26:47 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T04:26:47.886Z [container-agent] import json
2025-05-14T04:26:47.886Z [container-agent] import mysqlsh
2025-05-14T04:26:47.886Z [container-agent] import traceback
2025-05-14T04:26:47.886Z [container-agent] 
2025-05-14T04:26:47.886Z [container-agent] try:
2025-05-14T04:26:47.886Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T04:26:47.886Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T04:26:47.886Z [container-agent]     session.run_sql("DROP USER `mysql_router4_ld6qip4`")
2025-05-14T04:26:47.886Z [container-agent] 
2025-05-14T04:26:47.886Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T04:26:47.886Z [container-agent]     error = {
2025-05-14T04:26:47.886Z [container-agent]         "message": str(exception),
2025-05-14T04:26:47.886Z [container-agent]         "code": exception.code,
2025-05-14T04:26:47.886Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T04:26:47.886Z [container-agent]     }
2025-05-14T04:26:47.886Z [container-agent] else:
2025-05-14T04:26:47.886Z [container-agent]     error = None
2025-05-14T04:26:47.886Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T04:26:47.886Z [container-agent]     json.dump(error, file)
2025-05-14T04:26:47.886Z [container-agent] 
2025-05-14T04:26:47.886Z [container-agent] MySQL client error 1290
2025-05-14T04:26:47.886Z [container-agent] MySQL Shell traceback:
2025-05-14T04:26:47.886Z [container-agent] Traceback (most recent call last):
2025-05-14T04:26:47.886Z [container-agent]   File "<string>", line 8, in <module>
2025-05-14T04:26:47.886Z [container-agent] mysqlsh.DBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:26:47.886Z [container-agent] 
2025-05-14T04:26:47.886Z [container-agent] Traceback (most recent call last):
2025-05-14T04:26:47.886Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:26:47.886Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:26:47.886Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:26:47.950Z [container-agent] 2025-05-14 04:26:47 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T04:26:47.951Z [container-agent] Traceback (most recent call last):
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T04:26:47.951Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T04:26:47.951Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T04:26:47.951Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T04:26:47.951Z [container-agent]     framework._emit(event)
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T04:26:47.951Z [container-agent]     self._reemit(event_path)
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T04:26:47.951Z [container-agent]     custom_handler(event)
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:26:47.951Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 355, in reconcile
2025-05-14T04:26:47.951Z [container-agent]     workload_.reconcile(
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:26:47.951Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 399, in reconcile
2025-05-14T04:26:47.951Z [container-agent]     self._enable_router(event=event, tls=tls, unit_name=unit_name)
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:26:47.951Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 331, in _enable_router
2025-05-14T04:26:47.951Z [container-agent]     self._cleanup_after_upgrade_or_potential_container_restart()
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:26:47.951Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 230, in _cleanup_after_upgrade_or_potential_container_restart
2025-05-14T04:26:47.951Z [container-agent]     self.shell.delete_user(user_info.username)
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 207, in delete_user
2025-05-14T04:26:47.951Z [container-agent]     self._run_sql([statement])
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 113, in _run_sql
2025-05-14T04:26:47.951Z [container-agent]     self._run_code(
2025-05-14T04:26:47.951Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:26:47.951Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:26:47.951Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:26:49.886Z [container-agent] 2025-05-14 04:26:49 ERROR juju.worker.uniter.operation runhook.go:180 hook "start" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T04:26:49.895Z [container-agent] 2025-05-14 04:26:49 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:26:55.117Z [pebble] Check "readiness" failure 10/3: non-2xx status code 418
2025-05-14T04:27:05.112Z [pebble] Check "readiness" failure 11/3: non-2xx status code 418
2025-05-14T04:27:09.843Z [container-agent] 2025-05-14 04:27:09 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:27:15.153Z [pebble] Check "readiness" failure 12/3: non-2xx status code 418
2025-05-14T04:27:22.092Z [container-agent] 2025-05-14 04:27:22 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:27:22.255Z [container-agent] 2025-05-14 04:27:22 INFO juju-log Enabling MySQL Router service
2025-05-14T04:27:25.149Z [pebble] Check "readiness" failure 13/3: non-2xx status code 418
2025-05-14T04:27:25.963Z [container-agent] 2025-05-14 04:27:25 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T04:27:25.963Z [container-agent] import json
2025-05-14T04:27:25.963Z [container-agent] import mysqlsh
2025-05-14T04:27:25.963Z [container-agent] import traceback
2025-05-14T04:27:25.963Z [container-agent] 
2025-05-14T04:27:25.963Z [container-agent] try:
2025-05-14T04:27:25.963Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T04:27:25.963Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T04:27:25.963Z [container-agent]     session.run_sql("DROP USER `mysql_router4_ld6qip4`")
2025-05-14T04:27:25.963Z [container-agent] 
2025-05-14T04:27:25.963Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T04:27:25.963Z [container-agent]     error = {
2025-05-14T04:27:25.963Z [container-agent]         "message": str(exception),
2025-05-14T04:27:25.963Z [container-agent]         "code": exception.code,
2025-05-14T04:27:25.963Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T04:27:25.963Z [container-agent]     }
2025-05-14T04:27:25.963Z [container-agent] else:
2025-05-14T04:27:25.963Z [container-agent]     error = None
2025-05-14T04:27:25.963Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T04:27:25.963Z [container-agent]     json.dump(error, file)
2025-05-14T04:27:25.963Z [container-agent] 
2025-05-14T04:27:25.963Z [container-agent] MySQL client error 1290
2025-05-14T04:27:25.963Z [container-agent] MySQL Shell traceback:
2025-05-14T04:27:25.963Z [container-agent] Traceback (most recent call last):
2025-05-14T04:27:25.963Z [container-agent]   File "<string>", line 8, in <module>
2025-05-14T04:27:25.963Z [container-agent] mysqlsh.DBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:27:25.963Z [container-agent] 
2025-05-14T04:27:25.963Z [container-agent] Traceback (most recent call last):
2025-05-14T04:27:25.963Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:27:25.963Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:27:25.963Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:27:26.024Z [container-agent] 2025-05-14 04:27:26 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T04:27:26.025Z [container-agent] Traceback (most recent call last):
2025-05-14T04:27:26.025Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T04:27:26.025Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T04:27:26.025Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T04:27:26.025Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T04:27:26.025Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T04:27:26.025Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T04:27:26.025Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T04:27:26.025Z [container-agent]     framework._emit(event)
2025-05-14T04:27:26.031Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T04:27:26.035Z [container-agent]     self._reemit(event_path)
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T04:27:26.035Z [container-agent]     custom_handler(event)
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:27:26.035Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 355, in reconcile
2025-05-14T04:27:26.035Z [container-agent]     workload_.reconcile(
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:27:26.035Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 399, in reconcile
2025-05-14T04:27:26.035Z [container-agent]     self._enable_router(event=event, tls=tls, unit_name=unit_name)
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:27:26.035Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 331, in _enable_router
2025-05-14T04:27:26.035Z [container-agent]     self._cleanup_after_upgrade_or_potential_container_restart()
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:27:26.035Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 230, in _cleanup_after_upgrade_or_potential_container_restart
2025-05-14T04:27:26.035Z [container-agent]     self.shell.delete_user(user_info.username)
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 207, in delete_user
2025-05-14T04:27:26.035Z [container-agent]     self._run_sql([statement])
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 113, in _run_sql
2025-05-14T04:27:26.035Z [container-agent]     self._run_code(
2025-05-14T04:27:26.035Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:27:26.035Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:27:26.035Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:27:26.632Z [container-agent] 2025-05-14 04:27:26 ERROR juju.worker.uniter.operation runhook.go:180 hook "start" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T04:27:26.632Z [container-agent] 2025-05-14 04:27:26 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:27:35.142Z [pebble] Check "readiness" failure 14/3: non-2xx status code 418
2025-05-14T04:27:45.108Z [pebble] Check "readiness" failure 15/3: non-2xx status code 418
2025-05-14T04:27:55.117Z [pebble] Check "readiness" failure 16/3: non-2xx status code 418
2025-05-14T04:28:05.102Z [pebble] Check "readiness" failure 17/3: non-2xx status code 418
2025-05-14T04:28:06.893Z [container-agent] 2025-05-14 04:28:06 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:28:14.423Z [container-agent] 2025-05-14 04:28:14 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:28:14.539Z [container-agent] 2025-05-14 04:28:14 INFO juju-log Enabling MySQL Router service
2025-05-14T04:28:15.125Z [pebble] Check "readiness" failure 18/3: non-2xx status code 418
2025-05-14T04:28:17.863Z [container-agent] 2025-05-14 04:28:17 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T04:28:17.863Z [container-agent] import json
2025-05-14T04:28:17.863Z [container-agent] import mysqlsh
2025-05-14T04:28:17.863Z [container-agent] import traceback
2025-05-14T04:28:17.863Z [container-agent] 
2025-05-14T04:28:17.863Z [container-agent] try:
2025-05-14T04:28:17.863Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T04:28:17.863Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T04:28:17.863Z [container-agent]     session.run_sql("DROP USER `mysql_router4_ld6qip4`")
2025-05-14T04:28:17.863Z [container-agent] 
2025-05-14T04:28:17.863Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T04:28:17.863Z [container-agent]     error = {
2025-05-14T04:28:17.863Z [container-agent]         "message": str(exception),
2025-05-14T04:28:17.863Z [container-agent]         "code": exception.code,
2025-05-14T04:28:17.863Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T04:28:17.863Z [container-agent]     }
2025-05-14T04:28:17.863Z [container-agent] else:
2025-05-14T04:28:17.863Z [container-agent]     error = None
2025-05-14T04:28:17.863Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T04:28:17.863Z [container-agent]     json.dump(error, file)
2025-05-14T04:28:17.863Z [container-agent] 
2025-05-14T04:28:17.863Z [container-agent] MySQL client error 1290
2025-05-14T04:28:17.863Z [container-agent] MySQL Shell traceback:
2025-05-14T04:28:17.864Z [container-agent] Traceback (most recent call last):
2025-05-14T04:28:17.864Z [container-agent]   File "<string>", line 8, in <module>
2025-05-14T04:28:17.864Z [container-agent] mysqlsh.DBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:28:17.864Z [container-agent] 
2025-05-14T04:28:17.864Z [container-agent] Traceback (most recent call last):
2025-05-14T04:28:17.864Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:28:17.864Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:28:17.864Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:28:17.900Z [container-agent] 2025-05-14 04:28:17 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T04:28:17.900Z [container-agent] Traceback (most recent call last):
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T04:28:17.900Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T04:28:17.900Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T04:28:17.900Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T04:28:17.900Z [container-agent]     framework._emit(event)
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T04:28:17.900Z [container-agent]     self._reemit(event_path)
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T04:28:17.900Z [container-agent]     custom_handler(event)
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:28:17.900Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 355, in reconcile
2025-05-14T04:28:17.900Z [container-agent]     workload_.reconcile(
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:28:17.900Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 399, in reconcile
2025-05-14T04:28:17.900Z [container-agent]     self._enable_router(event=event, tls=tls, unit_name=unit_name)
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:28:17.900Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 331, in _enable_router
2025-05-14T04:28:17.900Z [container-agent]     self._cleanup_after_upgrade_or_potential_container_restart()
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:28:17.900Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 230, in _cleanup_after_upgrade_or_potential_container_restart
2025-05-14T04:28:17.900Z [container-agent]     self.shell.delete_user(user_info.username)
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 207, in delete_user
2025-05-14T04:28:17.900Z [container-agent]     self._run_sql([statement])
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 113, in _run_sql
2025-05-14T04:28:17.900Z [container-agent]     self._run_code(
2025-05-14T04:28:17.900Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:28:17.900Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:28:17.900Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:28:18.546Z [container-agent] 2025-05-14 04:28:18 ERROR juju.worker.uniter.operation runhook.go:180 hook "start" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T04:28:18.551Z [container-agent] 2025-05-14 04:28:18 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:28:25.099Z [pebble] Check "readiness" failure 19/3: non-2xx status code 418
2025-05-14T04:28:35.093Z [pebble] Check "readiness" failure 20/3: non-2xx status code 418
2025-05-14T04:28:45.092Z [pebble] Check "readiness" failure 21/3: non-2xx status code 418
2025-05-14T04:28:55.091Z [pebble] Check "readiness" failure 22/3: non-2xx status code 418
2025-05-14T04:29:05.094Z [pebble] Check "readiness" failure 23/3: non-2xx status code 418
2025-05-14T04:29:15.094Z [pebble] Check "readiness" failure 24/3: non-2xx status code 418
2025-05-14T04:29:25.094Z [pebble] Check "readiness" failure 25/3: non-2xx status code 418
2025-05-14T04:29:35.089Z [pebble] Check "readiness" failure 26/3: non-2xx status code 418
2025-05-14T04:29:36.786Z [container-agent] 2025-05-14 04:29:36 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:29:39.602Z [container-agent] 2025-05-14 04:29:39 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:29:39.665Z [container-agent] 2025-05-14 04:29:39 INFO juju-log Enabling MySQL Router service
2025-05-14T04:29:41.832Z [container-agent] 2025-05-14 04:29:41 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T04:29:41.832Z [container-agent] import json
2025-05-14T04:29:41.832Z [container-agent] import mysqlsh
2025-05-14T04:29:41.832Z [container-agent] import traceback
2025-05-14T04:29:41.832Z [container-agent] 
2025-05-14T04:29:41.832Z [container-agent] try:
2025-05-14T04:29:41.832Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T04:29:41.832Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T04:29:41.832Z [container-agent]     session.run_sql("DROP USER `mysql_router4_ld6qip4`")
2025-05-14T04:29:41.832Z [container-agent] 
2025-05-14T04:29:41.832Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T04:29:41.832Z [container-agent]     error = {
2025-05-14T04:29:41.832Z [container-agent]         "message": str(exception),
2025-05-14T04:29:41.832Z [container-agent]         "code": exception.code,
2025-05-14T04:29:41.832Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T04:29:41.832Z [container-agent]     }
2025-05-14T04:29:41.832Z [container-agent] else:
2025-05-14T04:29:41.832Z [container-agent]     error = None
2025-05-14T04:29:41.832Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T04:29:41.832Z [container-agent]     json.dump(error, file)
2025-05-14T04:29:41.832Z [container-agent] 
2025-05-14T04:29:41.832Z [container-agent] MySQL client error 1290
2025-05-14T04:29:41.832Z [container-agent] MySQL Shell traceback:
2025-05-14T04:29:41.832Z [container-agent] Traceback (most recent call last):
2025-05-14T04:29:41.832Z [container-agent]   File "<string>", line 8, in <module>
2025-05-14T04:29:41.832Z [container-agent] mysqlsh.DBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:29:41.832Z [container-agent] 
2025-05-14T04:29:41.832Z [container-agent] Traceback (most recent call last):
2025-05-14T04:29:41.832Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:29:41.832Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:29:41.832Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:29:41.868Z [container-agent] 2025-05-14 04:29:41 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T04:29:41.868Z [container-agent] Traceback (most recent call last):
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T04:29:41.868Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T04:29:41.868Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T04:29:41.868Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T04:29:41.868Z [container-agent]     framework._emit(event)
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T04:29:41.868Z [container-agent]     self._reemit(event_path)
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T04:29:41.868Z [container-agent]     custom_handler(event)
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:29:41.868Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 355, in reconcile
2025-05-14T04:29:41.868Z [container-agent]     workload_.reconcile(
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:29:41.868Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 399, in reconcile
2025-05-14T04:29:41.868Z [container-agent]     self._enable_router(event=event, tls=tls, unit_name=unit_name)
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:29:41.868Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 331, in _enable_router
2025-05-14T04:29:41.868Z [container-agent]     self._cleanup_after_upgrade_or_potential_container_restart()
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T04:29:41.868Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 230, in _cleanup_after_upgrade_or_potential_container_restart
2025-05-14T04:29:41.868Z [container-agent]     self.shell.delete_user(user_info.username)
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 207, in delete_user
2025-05-14T04:29:41.868Z [container-agent]     self._run_sql([statement])
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 113, in _run_sql
2025-05-14T04:29:41.868Z [container-agent]     self._run_code(
2025-05-14T04:29:41.868Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 99, in _run_code
2025-05-14T04:29:41.868Z [container-agent]     raise ShellDBError(**exception)
2025-05-14T04:29:41.868Z [container-agent] mysql_shell.ShellDBError: MySQL Error (1290): ClassicSession.run_sql: The MySQL server is running with the --super-read-only option so it cannot execute this statement
2025-05-14T04:29:42.411Z [container-agent] 2025-05-14 04:29:42 ERROR juju.worker.uniter.operation runhook.go:180 hook "start" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T04:29:42.419Z [container-agent] 2025-05-14 04:29:42 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:29:45.091Z [pebble] Check "readiness" failure 27/3: non-2xx status code 418
2025-05-14T04:29:55.088Z [pebble] Check "readiness" failure 28/3: non-2xx status code 418
2025-05-14T04:30:05.092Z [pebble] Check "readiness" failure 29/3: non-2xx status code 418
2025-05-14T04:30:15.093Z [pebble] Check "readiness" failure 30/3: non-2xx status code 418
2025-05-14T04:30:25.102Z [pebble] Check "readiness" failure 31/3: non-2xx status code 418
2025-05-14T04:30:32.038Z [container-agent] 2025-05-14 04:30:32 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:30:35.097Z [pebble] Check "readiness" failure 32/3: non-2xx status code 418
2025-05-14T04:30:45.094Z [pebble] Check "readiness" failure 33/3: non-2xx status code 418
2025-05-14T04:30:55.094Z [pebble] Check "readiness" failure 34/3: non-2xx status code 418
2025-05-14T04:31:05.102Z [pebble] Check "readiness" failure 35/3: non-2xx status code 418
2025-05-14T04:31:15.094Z [pebble] Check "readiness" failure 36/3: non-2xx status code 418
2025-05-14T04:31:25.105Z [pebble] Check "readiness" failure 37/3: non-2xx status code 418
2025-05-14T04:31:35.101Z [pebble] Check "readiness" failure 38/3: non-2xx status code 418
2025-05-14T04:31:45.104Z [pebble] Check "readiness" failure 39/3: non-2xx status code 418
2025-05-14T04:31:55.092Z [pebble] Check "readiness" failure 40/3: non-2xx status code 418
2025-05-14T04:32:05.110Z [pebble] Check "readiness" failure 41/3: non-2xx status code 418
2025-05-14T04:32:15.111Z [pebble] Check "readiness" failure 42/3: non-2xx status code 418
2025-05-14T04:32:20.982Z [container-agent] 2025-05-14 04:32:20 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T04:32:25.129Z [pebble] Check "readiness" failure 43/3: non-2xx status code 418
2025-05-14T04:32:25.513Z [container-agent] 2025-05-14 04:32:25 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:32:25.652Z [container-agent] 2025-05-14 04:32:25 INFO juju-log Enabling MySQL Router service
2025-05-14T04:32:34.575Z [container-agent] 2025-05-14 04:32:34 INFO juju-log Enabled MySQL Router service
2025-05-14T04:32:35.107Z [pebble] Check "readiness" failure 44/3: non-2xx status code 418
2025-05-14T04:32:37.318Z [container-agent] 2025-05-14 04:32:37 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:32:37.613Z [container-agent] 2025-05-14 04:32:37 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:32:40.441Z [container-agent] 2025-05-14 04:32:40 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T04:32:44.964Z [container-agent] 2025-05-14 04:32:44 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T04:32:51.176Z [container-agent] 2025-05-14 04:32:51 INFO juju.worker.uniter.operation runhook.go:186 ran "mysql-router-pebble-ready" hook (via hook dispatching script: dispatch)
2025-05-14T04:36:26.545Z [container-agent] 2025-05-14 04:36:26 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T04:42:12.367Z [container-agent] 2025-05-14 04:42:12 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T04:47:40.041Z [container-agent] 2025-05-14 04:47:40 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T04:52:10.708Z [container-agent] 2025-05-14 04:52:10 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T04:57:11.469Z [container-agent] 2025-05-14 04:57:11 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T05:02:37.393Z [container-agent] 2025-05-14 05:02:37 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T05:07:41.708Z [container-agent] 2025-05-14 05:07:41 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T05:12:45.022Z [container-agent] 2025-05-14 05:12:45 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T05:17:42.442Z [container-agent] 2025-05-14 05:17:42 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T05:22:28.329Z [container-agent] 2025-05-14 05:22:28 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:07:14.844Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:14.844Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:14.844Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:14.844Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:14.844Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:14.844Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.072Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.321Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.321Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:14 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:15 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.322Z [container-agent] 2025-05-14 07:07:15 ERROR juju.worker.dependency engine.go:695 "leadership-tracker" manifold worker returned unexpected error: leadership failure: error making a leadership claim: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:15.576Z [container-agent] 2025-05-14 07:07:15 INFO juju.worker.logger logger.go:136 logger worker stopped
2025-05-14T07:07:15.576Z [container-agent] 2025-05-14 07:07:15 ERROR juju.worker.dependency engine.go:695 "proxy-config-updater" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T07:07:15.576Z [container-agent] 2025-05-14 07:07:15 ERROR juju.worker.dependency engine.go:695 "upgrader" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T07:07:15.576Z [container-agent] 2025-05-14 07:07:15 ERROR juju.worker.dependency engine.go:695 "not-dead-flag" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T07:07:15.810Z [container-agent] 2025-05-14 07:07:15 ERROR juju.worker.dependency engine.go:695 "api-address-updater" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T07:07:15.810Z [container-agent] 2025-05-14 07:07:15 ERROR juju.worker.dependency engine.go:695 "dead-flag" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T07:07:15.810Z [container-agent] 2025-05-14 07:07:15 ERROR juju.worker.dependency engine.go:695 "migration-inactive-flag" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T07:07:15.869Z [container-agent] 2025-05-14 07:07:15 ERROR juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:47328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T07:07:16.463Z [container-agent] 2025-05-14 07:07:16 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T07:07:16.464Z [container-agent] Traceback (most recent call last):
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
2025-05-14T07:07:16.464Z [container-agent]     yield
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpx/_transports/default.py", line 233, in handle_request
2025-05-14T07:07:16.464Z [container-agent]     resp = self._pool.handle_request(req)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 216, in handle_request
2025-05-14T07:07:16.464Z [container-agent]     raise exc from None
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 196, in handle_request
2025-05-14T07:07:16.464Z [container-agent]     response = connection.handle_request(
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
2025-05-14T07:07:16.464Z [container-agent]     return self._connection.handle_request(request)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 143, in handle_request
2025-05-14T07:07:16.464Z [container-agent]     raise exc
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 113, in handle_request
2025-05-14T07:07:16.464Z [container-agent]     ) = self._receive_response_headers(**kwargs)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 186, in _receive_response_headers
2025-05-14T07:07:16.464Z [container-agent]     event = self._receive_event(timeout=timeout)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 238, in _receive_event
2025-05-14T07:07:16.464Z [container-agent]     raise RemoteProtocolError(msg)
2025-05-14T07:07:16.464Z [container-agent] httpcore.RemoteProtocolError: Server disconnected without sending a response.
2025-05-14T07:07:16.464Z [container-agent] 
2025-05-14T07:07:16.464Z [container-agent] The above exception was the direct cause of the following exception:
2025-05-14T07:07:16.464Z [container-agent] 
2025-05-14T07:07:16.464Z [container-agent] Traceback (most recent call last):
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T07:07:16.464Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T07:07:16.464Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T07:07:16.464Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T07:07:16.464Z [container-agent]     framework._emit(event)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T07:07:16.464Z [container-agent]     self._reemit(event_path)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T07:07:16.464Z [container-agent]     custom_handler(event)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T07:07:16.464Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 375, in reconcile
2025-05-14T07:07:16.464Z [container-agent]     self.set_status(event=event)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T07:07:16.464Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 232, in set_status
2025-05-14T07:07:16.464Z [container-agent]     self.unit.status = self._determine_unit_status(event=event)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T07:07:16.464Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 218, in _determine_unit_status
2025-05-14T07:07:16.464Z [container-agent]     if self._upgrade:
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 110, in _upgrade
2025-05-14T07:07:16.464Z [container-agent]     return kubernetes_upgrade.Upgrade(self)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/kubernetes_upgrade.py", line 74, in __init__
2025-05-14T07:07:16.464Z [container-agent]     partition.get(app_name=charm_.app.name)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/kubernetes_upgrade.py", line 55, in get
2025-05-14T07:07:16.464Z [container-agent]     lightkube.Client()
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/lightkube/core/client.py", line 140, in get
2025-05-14T07:07:16.464Z [container-agent]     return self._client.request("get", res=res, name=name, namespace=namespace)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 244, in request
2025-05-14T07:07:16.464Z [container-agent]     resp = self.send(req)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 216, in send
2025-05-14T07:07:16.464Z [container-agent]     return self._client.send(req, stream=stream)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpx/_client.py", line 914, in send
2025-05-14T07:07:16.464Z [container-agent]     response = self._send_handling_auth(
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpx/_client.py", line 942, in _send_handling_auth
2025-05-14T07:07:16.464Z [container-agent]     response = self._send_handling_redirects(
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
2025-05-14T07:07:16.464Z [container-agent]     response = self._send_single_request(request)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpx/_client.py", line 1015, in _send_single_request
2025-05-14T07:07:16.464Z [container-agent]     response = transport.handle_request(request)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpx/_transports/default.py", line 232, in handle_request
2025-05-14T07:07:16.464Z [container-agent]     with map_httpcore_exceptions():
2025-05-14T07:07:16.464Z [container-agent]   File "/usr/lib/python3.10/contextlib.py", line 153, in __exit__
2025-05-14T07:07:16.464Z [container-agent]     self.gen.throw(typ, value, traceback)
2025-05-14T07:07:16.464Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
2025-05-14T07:07:16.464Z [container-agent]     raise mapped_exc(message) from exc
2025-05-14T07:07:16.464Z [container-agent] httpx.RemoteProtocolError: Server disconnected without sending a response.
2025-05-14T07:07:22.556Z [container-agent] 2025-05-14 07:07:22 INFO juju.api apiclient.go:979 cannot resolve "controller-service.controller-sunbeam-controller.svc.cluster.local": lookup controller-service.controller-sunbeam-controller.svc.cluster.local: operation was canceled
2025-05-14T07:07:22.556Z [container-agent] 2025-05-14 07:07:22 INFO juju.api apiclient.go:601 connection established to "wss://172.16.1.201:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T07:07:23.916Z [container-agent] 2025-05-14 07:07:23 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-neutron-mysql-router-0" successfully connected to "wss://172.16.1.201:17070"
2025-05-14T07:07:24.090Z [container-agent] 2025-05-14 07:07:24 ERROR juju.worker.uniter.operation runhook.go:180 hook "update-status" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T07:07:24.099Z [container-agent] 2025-05-14 07:07:24 INFO juju.worker.uniter uniter.go:349 unit "neutron-mysql-router/0" shutting down: (re)starting watcher: connection is shut down
2025-05-14T07:07:24.332Z [container-agent] 2025-05-14 07:07:24 INFO juju.worker.logger logger.go:120 logger worker started
2025-05-14T07:07:24.399Z [container-agent] 2025-05-14 07:07:24 INFO juju.worker.migrationminion worker.go:208 migration phase is now: NONE
2025-05-14T07:07:25.334Z [container-agent] 2025-05-14 07:07:25 WARNING juju.worker.proxyupdater proxyupdater.go:237 unable to set snap core settings [proxy.http= proxy.https= proxy.store=]: exec: "snap": executable file not found in $PATH, output: ""
2025-05-14T07:07:25.525Z [pebble] Check "readiness" failure 1/3: non-2xx status code 418
2025-05-14T07:07:25.641Z [container-agent] 2025-05-14 07:07:25 INFO juju.worker.caasupgrader upgrader.go:113 abort check blocked until version event received
2025-05-14T07:07:25.648Z [container-agent] 2025-05-14 07:07:25 INFO juju.worker.caasupgrader upgrader.go:119 unblocking abort check
2025-05-14T07:07:25.893Z [container-agent] 2025-05-14 07:07:25 INFO juju.agent.tools symlinks.go:20 ensure jujuc symlinks in /var/lib/juju/tools/unit-neutron-mysql-router-0
2025-05-14T07:07:26.930Z [container-agent] 2025-05-14 07:07:26 INFO juju.worker.leadership tracker.go:244 neutron-mysql-router/0 promoted to leadership of neutron-mysql-router
2025-05-14T07:07:30.672Z [container-agent] 2025-05-14 07:07:30 INFO juju.worker.uniter uniter.go:365 unit "neutron-mysql-router/0" started
2025-05-14T07:07:31.168Z [container-agent] 2025-05-14 07:07:31 INFO juju.worker.uniter uniter.go:391 hooks are retried true
2025-05-14T07:07:35.533Z [container-agent] 2025-05-14 07:07:35 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T07:07:35.755Z [container-agent] 2025-05-14 07:07:35 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T07:07:35.906Z [pebble] Check "readiness" failure 2/3: non-2xx status code 418
2025-05-14T07:07:40.766Z [container-agent] 2025-05-14 07:07:40 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T07:07:45.348Z [pebble] Check "readiness" failure 3/3: non-2xx status code 418
2025-05-14T07:07:45.348Z [pebble] Check "readiness" threshold 3 hit, triggering action and recovering
2025-05-14T07:07:45.349Z [pebble] Change 61 task (Perform HTTP check "readiness") failed: non-2xx status code 418
2025-05-14T07:07:55.691Z [pebble] Check "readiness" failure 4/3: non-2xx status code 418
2025-05-14T07:08:05.626Z [pebble] Check "readiness" failure 5/3: non-2xx status code 418
2025-05-14T07:08:07.804Z [container-agent] 2025-05-14 07:08:07 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T07:08:15.465Z [container-agent] 2025-05-14 07:08:15 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T07:08:15.465Z [container-agent] import json
2025-05-14T07:08:15.465Z [container-agent] import mysqlsh
2025-05-14T07:08:15.465Z [container-agent] import traceback
2025-05-14T07:08:15.465Z [container-agent] 
2025-05-14T07:08:15.465Z [container-agent] try:
2025-05-14T07:08:15.465Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T07:08:15.465Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T07:08:15.465Z [container-agent]     import json
2025-05-14T07:08:15.465Z [container-agent] 
2025-05-14T07:08:15.465Z [container-agent]     cluster_set = dba.get_cluster_set()
2025-05-14T07:08:15.465Z [container-agent]     routers = cluster_set.list_routers()
2025-05-14T07:08:15.465Z [container-agent]     # mysqlsh objects are weirdâ€”they quack (i.e. duck typing) like standard Python objects (e.g. list,
2025-05-14T07:08:15.465Z [container-agent]     # dict), but do not serialize to JSON correctly.
2025-05-14T07:08:15.465Z [container-agent]     # Cast to str & load from JSON str before serializing
2025-05-14T07:08:15.465Z [container-agent]     routers = json.loads(str(routers))
2025-05-14T07:08:15.465Z [container-agent]     with open("/tmp/mysqlsh_output.json", "w") as file:
2025-05-14T07:08:15.465Z [container-agent]         json.dump(routers, file)
2025-05-14T07:08:15.465Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T07:08:15.465Z [container-agent]     error = {
2025-05-14T07:08:15.465Z [container-agent]         "message": str(exception),
2025-05-14T07:08:15.465Z [container-agent]         "code": exception.code,
2025-05-14T07:08:15.465Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T07:08:15.465Z [container-agent]     }
2025-05-14T07:08:15.465Z [container-agent] else:
2025-05-14T07:08:15.465Z [container-agent]     error = None
2025-05-14T07:08:15.465Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T07:08:15.465Z [container-agent]     json.dump(error, file)
2025-05-14T07:08:15.465Z [container-agent] 
2025-05-14T07:08:15.465Z [container-agent] stderr:
2025-05-14T07:08:15.465Z [container-agent] Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory
2025-05-14T07:08:15.465Z [container-agent] MySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)
2025-05-14T07:08:15.465Z [container-agent] 
2025-05-14T07:08:15.465Z [container-agent] Traceback (most recent call last):
2025-05-14T07:08:15.465Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T07:08:15.465Z [container-agent]     output, _ = process.wait_output()
2025-05-14T07:08:15.465Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T07:08:15.465Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T07:08:15.465Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T07:08:15.465Z [container-agent] 
2025-05-14T07:08:15.465Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T07:08:15.465Z [container-agent] 
2025-05-14T07:08:15.465Z [container-agent] Traceback (most recent call last):
2025-05-14T07:08:15.465Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T07:08:15.465Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T07:08:15.465Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T07:08:15.465Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T07:08:15.465Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T07:08:15.465Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T07:08:15.465Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T07:08:15.465Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T07:08:15.465Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T07:08:15.465Z [container-agent]     raise container.CalledProcessError(
2025-05-14T07:08:15.465Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T07:08:15.703Z [pebble] Check "readiness" failure 6/3: non-2xx status code 418
2025-05-14T07:08:15.806Z [container-agent] 2025-05-14 07:08:15 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T07:08:15.806Z [container-agent] Traceback (most recent call last):
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T07:08:15.806Z [container-agent]     output, _ = process.wait_output()
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T07:08:15.806Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T07:08:15.806Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T07:08:15.806Z [container-agent] 
2025-05-14T07:08:15.806Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T07:08:15.806Z [container-agent] 
2025-05-14T07:08:15.806Z [container-agent] Traceback (most recent call last):
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T07:08:15.806Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T07:08:15.806Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T07:08:15.806Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T07:08:15.806Z [container-agent]     framework._emit(event)
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T07:08:15.806Z [container-agent]     self._reemit(event_path)
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T07:08:15.806Z [container-agent]     custom_handler(event)
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T07:08:15.806Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 371, in reconcile
2025-05-14T07:08:15.806Z [container-agent]     if not workload_.status or workload_.status == ops.WaitingStatus():
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 414, in status
2025-05-14T07:08:15.806Z [container-agent]     if not self.shell.is_router_in_cluster_set(self._router_id):
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 214, in is_router_in_cluster_set
2025-05-14T07:08:15.806Z [container-agent]     self._run_code(
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T07:08:15.806Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T07:08:15.806Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T07:08:15.806Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T07:08:15.806Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T07:08:15.806Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T07:08:15.806Z [container-agent]     raise container.CalledProcessError(
2025-05-14T07:08:15.806Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T07:08:17.407Z [container-agent] 2025-05-14 07:08:17 ERROR juju.worker.uniter.operation runhook.go:180 hook "update-status" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T07:08:17.424Z [container-agent] 2025-05-14 07:08:17 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T07:08:25.658Z [pebble] Check "readiness" failure 7/3: non-2xx status code 418
2025-05-14T07:08:27.603Z [container-agent] 2025-05-14 07:08:27 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T07:08:35.692Z [pebble] Check "readiness" failure 8/3: non-2xx status code 418
2025-05-14T07:08:45.789Z [pebble] Check "readiness" failure 9/3: non-2xx status code 418
2025-05-14T07:08:48.793Z [container-agent] 2025-05-14 07:08:48 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T07:08:55.645Z [pebble] Check "readiness" failure 10/3: non-2xx status code 418
2025-05-14T07:09:02.398Z [container-agent] 2025-05-14 07:09:02 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T07:09:03.135Z [container-agent] 2025-05-14 07:09:03 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T07:09:05.704Z [pebble] Check "readiness" failure 11/3: non-2xx status code 418
2025-05-14T07:09:13.906Z [container-agent] 2025-05-14 07:09:13 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:09:13.947Z [container-agent] 2025-05-14 07:09:13 INFO juju.worker.uniter resolver.go:76 reboot detected; triggering implicit start hook to notify charm
2025-05-14T07:09:15.806Z [pebble] Check "readiness" failure 12/3: non-2xx status code 418
2025-05-14T07:09:25.646Z [pebble] Check "readiness" failure 13/3: non-2xx status code 418
2025-05-14T07:09:28.524Z [container-agent] 2025-05-14 07:09:28 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T07:09:35.670Z [pebble] Check "readiness" failure 14/3: non-2xx status code 418
2025-05-14T07:09:36.738Z [container-agent] 2025-05-14 07:09:36 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T07:09:37.332Z [container-agent] 2025-05-14 07:09:37 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T07:09:45.499Z [container-agent] 2025-05-14 07:09:45 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T07:10:17.752Z [container-agent] 2025-05-14 07:10:17 INFO juju.worker.uniter.operation runhook.go:186 ran "mysql-router-pebble-ready" hook (via hook dispatching script: dispatch)
2025-05-14T07:12:17.182Z [container-agent] 2025-05-14 07:12:17 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:17:25.700Z [container-agent] 2025-05-14 07:17:25 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:22:37.989Z [container-agent] 2025-05-14 07:22:37 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:27:19.179Z [container-agent] 2025-05-14 07:27:19 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:31:24.298Z [container-agent] 2025-05-14 07:31:24 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:37:22.448Z [container-agent] 2025-05-14 07:37:22 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:42:04.116Z [container-agent] 2025-05-14 07:42:04 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:47:21.526Z [container-agent] 2025-05-14 07:47:21 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:52:36.939Z [container-agent] 2025-05-14 07:52:36 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:57:41.229Z [container-agent] 2025-05-14 07:57:41 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:02:15.115Z [container-agent] 2025-05-14 08:02:15 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:06:56.290Z [container-agent] 2025-05-14 08:06:56 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:11:49.115Z [container-agent] 2025-05-14 08:11:49 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:16:45.455Z [container-agent] 2025-05-14 08:16:45 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:21:05.570Z [container-agent] 2025-05-14 08:21:05 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:25:15.441Z [container-agent] 2025-05-14 08:25:15 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:30:44.338Z [container-agent] 2025-05-14 08:30:44 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:35:35.313Z [container-agent] 2025-05-14 08:35:35 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:41:09.125Z [container-agent] 2025-05-14 08:41:09 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:45:27.709Z [container-agent] 2025-05-14 08:45:27 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:49:55.787Z [container-agent] 2025-05-14 08:49:55 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:55:38.731Z [container-agent] 2025-05-14 08:55:38 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:00:49.131Z [container-agent] 2025-05-14 09:00:49 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:04:58.592Z [container-agent] 2025-05-14 09:04:58 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:09:57.980Z [container-agent] 2025-05-14 09:09:57 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:14:16.220Z [container-agent] 2025-05-14 09:14:16 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:19:16.620Z [container-agent] 2025-05-14 09:19:16 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:24:24.462Z [container-agent] 2025-05-14 09:24:24 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:29:24.686Z [container-agent] 2025-05-14 09:29:24 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:29:24.686Z [container-agent] 2025-05-14 09:29:24 ERROR juju.worker.dependency engine.go:695 "log-sender" manifold worker returned unexpected error: sending log message: websocket: close 1005 (no status): websocket: close sent
2025-05-14T09:34:17.256Z [container-agent] 2025-05-14 09:34:17 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:39:24.546Z [container-agent] 2025-05-14 09:39:24 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:43:31.881Z [container-agent] 2025-05-14 09:43:31 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:48:31.310Z [container-agent] 2025-05-14 09:48:31 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:53:48.259Z [container-agent] 2025-05-14 09:53:48 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:59:04.553Z [container-agent] 2025-05-14 09:59:04 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:04:13.463Z [container-agent] 2025-05-14 10:04:13 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:08:48.167Z [container-agent] 2025-05-14 10:08:48 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:14:15.338Z [container-agent] 2025-05-14 10:14:15 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:18:16.483Z [container-agent] 2025-05-14 10:18:16 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:24:05.031Z [container-agent] 2025-05-14 10:24:05 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:28:06.656Z [container-agent] 2025-05-14 10:28:06 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.94:57328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.94:57328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.94:57328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.94:57328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:57328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:57328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "leadership-tracker" manifold worker returned unexpected error: leadership failure: error making a leadership claim: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:57328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "upgrader" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "proxy-config-updater" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.uniter agent.go:33 resolver loop error: preparing operation "run update-status hook" for neutron-mysql-router/0: getting unit payloads: connection is shut down
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.uniter agent.go:36 updating agent status: connection is shut down
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 INFO juju.worker.uniter uniter.go:349 unit "neutron-mysql-router/0" shutting down: preparing operation "run update-status hook" for neutron-mysql-router/0: getting unit payloads: connection is shut down
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 INFO juju.worker.logger logger.go:136 logger worker stopped
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "logging-config-updater" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "hook-retry-strategy" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "api-address-updater" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "dead-flag" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "not-dead-flag" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "migration-inactive-flag" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T11:22:25.699Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "migration-minion" manifold worker returned unexpected error: watcher has been stopped (stopped)
2025-05-14T11:22:26.139Z [container-agent] 2025-05-14 11:22:26 ERROR juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:57328->172.16.1.201:17070: write: connection reset by peer
2025-05-14T11:22:29.857Z [container-agent] 2025-05-14 11:22:29 INFO juju.api apiclient.go:979 cannot resolve "controller-service.controller-sunbeam-controller.svc.cluster.local": lookup controller-service.controller-sunbeam-controller.svc.cluster.local: operation was canceled
2025-05-14T11:22:29.871Z [container-agent] 2025-05-14 11:22:29 INFO juju.api apiclient.go:601 connection established to "wss://10.152.183.59:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T11:22:31.148Z [container-agent] 2025-05-14 11:22:31 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-neutron-mysql-router-0" successfully connected to "wss://10.152.183.59:17070"
2025-05-14T11:22:32.203Z [container-agent] 2025-05-14 11:22:31 INFO juju.worker.logger logger.go:120 logger worker started
2025-05-14T11:22:32.203Z [container-agent] 2025-05-14 11:22:32 INFO juju.worker.migrationminion worker.go:208 migration phase is now: NONE
2025-05-14T11:22:34.113Z [container-agent] 2025-05-14 11:22:34 WARNING juju.worker.proxyupdater proxyupdater.go:237 unable to set snap core settings [proxy.http= proxy.https= proxy.store=]: exec: "snap": executable file not found in $PATH, output: ""
2025-05-14T11:22:35.978Z [container-agent] 2025-05-14 11:22:35 INFO juju.worker.leadership tracker.go:244 neutron-mysql-router/0 promoted to leadership of neutron-mysql-router
2025-05-14T11:22:36.179Z [container-agent] 2025-05-14 11:22:36 INFO juju.worker.caasupgrader upgrader.go:113 abort check blocked until version event received
2025-05-14T11:22:36.179Z [container-agent] 2025-05-14 11:22:36 INFO juju.worker.caasupgrader upgrader.go:119 unblocking abort check
2025-05-14T11:22:36.565Z [pebble] Check "readiness" failure 1/3: non-2xx status code 418
2025-05-14T11:22:36.755Z [container-agent] 2025-05-14 11:22:36 INFO juju.agent.tools symlinks.go:20 ensure jujuc symlinks in /var/lib/juju/tools/unit-neutron-mysql-router-0
2025-05-14T11:22:42.788Z [container-agent] 2025-05-14 11:22:42 INFO juju.worker.uniter uniter.go:365 unit "neutron-mysql-router/0" started
2025-05-14T11:22:43.447Z [container-agent] 2025-05-14 11:22:43 INFO juju.worker.uniter uniter.go:391 hooks are retried true
2025-05-14T11:22:45.873Z [container-agent] 2025-05-14 11:22:45 INFO juju.worker.uniter resolver.go:76 reboot detected; triggering implicit start hook to notify charm
2025-05-14T11:22:45.891Z [pebble] Check "readiness" failure 2/3: non-2xx status code 418
2025-05-14T11:22:55.755Z [pebble] Check "readiness" failure 3/3: non-2xx status code 418
2025-05-14T11:22:55.756Z [pebble] Check "readiness" threshold 3 hit, triggering action and recovering
2025-05-14T11:22:55.756Z [pebble] Change 63 task (Perform HTTP check "readiness") failed: non-2xx status code 418
2025-05-14T11:23:06.145Z [pebble] Check "readiness" failure 4/3: non-2xx status code 418
2025-05-14T11:23:16.234Z [pebble] Check "readiness" failure 5/3: non-2xx status code 418
2025-05-14T11:23:23.630Z [container-agent] 2025-05-14 11:23:23 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T11:23:23.630Z [container-agent] import json
2025-05-14T11:23:23.630Z [container-agent] import mysqlsh
2025-05-14T11:23:23.630Z [container-agent] import traceback
2025-05-14T11:23:23.630Z [container-agent] 
2025-05-14T11:23:23.630Z [container-agent] try:
2025-05-14T11:23:23.630Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T11:23:23.630Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T11:23:23.630Z [container-agent]     import json
2025-05-14T11:23:23.630Z [container-agent] 
2025-05-14T11:23:23.630Z [container-agent]     cluster_set = dba.get_cluster_set()
2025-05-14T11:23:23.630Z [container-agent]     routers = cluster_set.list_routers()
2025-05-14T11:23:23.630Z [container-agent]     # mysqlsh objects are weirdâ€”they quack (i.e. duck typing) like standard Python objects (e.g. list,
2025-05-14T11:23:23.630Z [container-agent]     # dict), but do not serialize to JSON correctly.
2025-05-14T11:23:23.630Z [container-agent]     # Cast to str & load from JSON str before serializing
2025-05-14T11:23:23.630Z [container-agent]     routers = json.loads(str(routers))
2025-05-14T11:23:23.630Z [container-agent]     with open("/tmp/mysqlsh_output.json", "w") as file:
2025-05-14T11:23:23.630Z [container-agent]         json.dump(routers, file)
2025-05-14T11:23:23.630Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T11:23:23.630Z [container-agent]     error = {
2025-05-14T11:23:23.630Z [container-agent]         "message": str(exception),
2025-05-14T11:23:23.630Z [container-agent]         "code": exception.code,
2025-05-14T11:23:23.630Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T11:23:23.630Z [container-agent]     }
2025-05-14T11:23:23.630Z [container-agent] else:
2025-05-14T11:23:23.630Z [container-agent]     error = None
2025-05-14T11:23:23.630Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T11:23:23.630Z [container-agent]     json.dump(error, file)
2025-05-14T11:23:23.630Z [container-agent] 
2025-05-14T11:23:23.630Z [container-agent] stderr:
2025-05-14T11:23:23.630Z [container-agent] Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory
2025-05-14T11:23:23.630Z [container-agent] MySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)
2025-05-14T11:23:23.630Z [container-agent] 
2025-05-14T11:23:23.630Z [container-agent] Traceback (most recent call last):
2025-05-14T11:23:23.630Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T11:23:23.630Z [container-agent]     output, _ = process.wait_output()
2025-05-14T11:23:23.630Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T11:23:23.630Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T11:23:23.630Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T11:23:23.630Z [container-agent] 
2025-05-14T11:23:23.630Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T11:23:23.630Z [container-agent] 
2025-05-14T11:23:23.630Z [container-agent] Traceback (most recent call last):
2025-05-14T11:23:23.630Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T11:23:23.630Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T11:23:23.630Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:23.630Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:23.630Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T11:23:23.630Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T11:23:23.630Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:23.630Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:23.630Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T11:23:23.630Z [container-agent]     raise container.CalledProcessError(
2025-05-14T11:23:23.630Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T11:23:23.902Z [container-agent] 2025-05-14 11:23:23 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T11:23:23.902Z [container-agent] Traceback (most recent call last):
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T11:23:23.902Z [container-agent]     output, _ = process.wait_output()
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T11:23:23.902Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T11:23:23.902Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T11:23:23.902Z [container-agent] 
2025-05-14T11:23:23.902Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T11:23:23.902Z [container-agent] 
2025-05-14T11:23:23.902Z [container-agent] Traceback (most recent call last):
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T11:23:23.902Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T11:23:23.902Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T11:23:23.902Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T11:23:23.902Z [container-agent]     framework._emit(event)
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T11:23:23.902Z [container-agent]     self._reemit(event_path)
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T11:23:23.902Z [container-agent]     custom_handler(event)
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:23.902Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 371, in reconcile
2025-05-14T11:23:23.902Z [container-agent]     if not workload_.status or workload_.status == ops.WaitingStatus():
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 414, in status
2025-05-14T11:23:23.902Z [container-agent]     if not self.shell.is_router_in_cluster_set(self._router_id):
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 214, in is_router_in_cluster_set
2025-05-14T11:23:23.902Z [container-agent]     self._run_code(
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T11:23:23.902Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:23.902Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T11:23:23.902Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:23.902Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:23.902Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T11:23:23.902Z [container-agent]     raise container.CalledProcessError(
2025-05-14T11:23:23.902Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T11:23:24.608Z [container-agent] 2025-05-14 11:23:24 ERROR juju.worker.uniter.operation runhook.go:180 hook "start" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T11:23:24.623Z [container-agent] 2025-05-14 11:23:24 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T11:23:26.132Z [pebble] Check "readiness" failure 6/3: non-2xx status code 418
2025-05-14T11:23:29.694Z [container-agent] 2025-05-14 11:23:29 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T11:23:36.218Z [pebble] Check "readiness" failure 7/3: non-2xx status code 418
2025-05-14T11:23:44.979Z [container-agent] 2025-05-14 11:23:44 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T11:23:46.178Z [pebble] Check "readiness" failure 8/3: non-2xx status code 418
2025-05-14T11:23:55.374Z [container-agent] 2025-05-14 11:23:55 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T11:23:56.109Z [container-agent] 2025-05-14 11:23:56 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T11:23:56.403Z [pebble] Check "readiness" failure 9/3: non-2xx status code 418
2025-05-14T11:24:05.113Z [container-agent] 2025-05-14 11:24:05 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T11:24:44.674Z [container-agent] 2025-05-14 11:24:44 INFO juju.worker.uniter.operation runhook.go:186 ran "mysql-router-pebble-ready" hook (via hook dispatching script: dispatch)
2025-05-14T11:27:47.458Z [container-agent] 2025-05-14 11:27:47 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:32:32.653Z [container-agent] 2025-05-14 11:32:32 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:38:28.040Z [container-agent] 2025-05-14 11:38:28 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:42:58.032Z [container-agent] 2025-05-14 11:42:58 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:48:58.833Z [container-agent] 2025-05-14 11:48:58 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:53:53.938Z [container-agent] 2025-05-14 11:53:53 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:59:27.456Z [container-agent] 2025-05-14 11:59:27 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:04:02.416Z [container-agent] 2025-05-14 12:04:02 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:09:05.068Z [container-agent] 2025-05-14 12:09:05 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:14:10.011Z [container-agent] 2025-05-14 12:14:10 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:19:43.514Z [container-agent] 2025-05-14 12:19:43 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:24:22.590Z [container-agent] 2025-05-14 12:24:22 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:30:01.657Z [container-agent] 2025-05-14 12:30:01 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:34:50.039Z [container-agent] 2025-05-14 12:34:50 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:39:50.659Z [container-agent] 2025-05-14 12:39:50 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:44:51.274Z [container-agent] 2025-05-14 12:44:51 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:49:24.977Z [container-agent] 2025-05-14 12:49:24 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:54:07.034Z [container-agent] 2025-05-14 12:54:07 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:57:31.709Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "migration-minion" manifold worker returned unexpected error: hub txn watcher sync error: starting change stream: read tcp 127.0.0.1:50396->127.0.0.1:37017: i/o timeout
2025-05-14T12:57:31.709Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "log-sender" manifold worker returned unexpected error: sending log message: write tcp 10.1.0.94:56854->10.152.183.59:17070: write: broken pipe: write tcp 10.1.0.94:56854->10.152.183.59:17070: write: broken pipe
2025-05-14T12:57:31.730Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.730Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.730Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.730Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.749Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.774Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.774Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.774Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.94:56830->10.152.183.59:17070: write: connection reset by peer
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 INFO juju.worker.logger logger.go:136 logger worker stopped
2025-05-14T12:57:31.812Z [container-agent] 2025-05-14 12:57:31 INFO juju.worker.uniter uniter.go:349 unit "neutron-mysql-router/0" shutting down: catacomb 0xc00062a008 is dying
2025-05-14T12:57:35.107Z [container-agent] 2025-05-14 12:57:35 INFO juju.api apiclient.go:601 connection established to "wss://172.16.1.201:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T12:57:35.542Z [container-agent] 2025-05-14 12:57:35 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-neutron-mysql-router-0" successfully connected to "wss://172.16.1.201:17070"
2025-05-14T12:57:35.634Z [container-agent] 2025-05-14 12:57:35 INFO juju.worker.migrationminion worker.go:208 migration phase is now: NONE
2025-05-14T12:57:35.634Z [container-agent] 2025-05-14 12:57:35 INFO juju.worker.logger logger.go:120 logger worker started
2025-05-14T12:57:36.135Z [container-agent] 2025-05-14 12:57:36 WARNING juju.worker.proxyupdater proxyupdater.go:237 unable to set snap core settings [proxy.http= proxy.https= proxy.store=]: exec: "snap": executable file not found in $PATH, output: ""
2025-05-14T12:57:37.102Z [container-agent] 2025-05-14 12:57:37 INFO juju.worker.leadership tracker.go:244 neutron-mysql-router/0 promoted to leadership of neutron-mysql-router
2025-05-14T12:57:37.118Z [container-agent] 2025-05-14 12:57:37 INFO juju.worker.caasupgrader upgrader.go:113 abort check blocked until version event received
2025-05-14T12:57:37.122Z [container-agent] 2025-05-14 12:57:37 INFO juju.worker.caasupgrader upgrader.go:119 unblocking abort check
2025-05-14T12:57:37.202Z [container-agent] 2025-05-14 12:57:37 INFO juju.agent.tools symlinks.go:20 ensure jujuc symlinks in /var/lib/juju/tools/unit-neutron-mysql-router-0
2025-05-14T12:57:43.323Z [container-agent] 2025-05-14 12:57:43 INFO juju.worker.uniter uniter.go:365 unit "neutron-mysql-router/0" started
2025-05-14T12:57:43.726Z [container-agent] 2025-05-14 12:57:43 INFO juju.worker.uniter uniter.go:391 hooks are retried true
2025-05-14T12:57:46.384Z [pebble] Check "readiness" failure 1/3: non-2xx status code 418
2025-05-14T12:57:46.783Z [container-agent] 2025-05-14 12:57:46 INFO juju.worker.uniter resolver.go:76 reboot detected; triggering implicit start hook to notify charm
2025-05-14T12:57:56.557Z [pebble] Check "readiness" failure 2/3: non-2xx status code 418
2025-05-14T12:58:06.447Z [pebble] Check "readiness" failure 3/3: non-2xx status code 418
2025-05-14T12:58:06.447Z [pebble] Check "readiness" threshold 3 hit, triggering action and recovering
2025-05-14T12:58:06.448Z [pebble] Change 65 task (Perform HTTP check "readiness") failed: non-2xx status code 418
2025-05-14T12:58:10.172Z [container-agent] 2025-05-14 12:58:10 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:16.740Z [pebble] Check "readiness" failure 4/3: non-2xx status code 418
2025-05-14T12:58:22.153Z [container-agent] 2025-05-14 12:58:22 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:22.865Z [container-agent] 2025-05-14 12:58:22 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:26.701Z [pebble] Check "readiness" failure 5/3: non-2xx status code 418
2025-05-14T12:58:27.394Z [container-agent] 2025-05-14 12:58:27 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T12:58:27.394Z [container-agent] import json
2025-05-14T12:58:27.394Z [container-agent] import mysqlsh
2025-05-14T12:58:27.394Z [container-agent] import traceback
2025-05-14T12:58:27.394Z [container-agent] 
2025-05-14T12:58:27.394Z [container-agent] try:
2025-05-14T12:58:27.394Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T12:58:27.394Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T12:58:27.394Z [container-agent]     import json
2025-05-14T12:58:27.394Z [container-agent] 
2025-05-14T12:58:27.394Z [container-agent]     cluster_set = dba.get_cluster_set()
2025-05-14T12:58:27.394Z [container-agent]     routers = cluster_set.list_routers()
2025-05-14T12:58:27.394Z [container-agent]     # mysqlsh objects are weirdâ€”they quack (i.e. duck typing) like standard Python objects (e.g. list,
2025-05-14T12:58:27.394Z [container-agent]     # dict), but do not serialize to JSON correctly.
2025-05-14T12:58:27.394Z [container-agent]     # Cast to str & load from JSON str before serializing
2025-05-14T12:58:27.394Z [container-agent]     routers = json.loads(str(routers))
2025-05-14T12:58:27.394Z [container-agent]     with open("/tmp/mysqlsh_output.json", "w") as file:
2025-05-14T12:58:27.394Z [container-agent]         json.dump(routers, file)
2025-05-14T12:58:27.394Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T12:58:27.394Z [container-agent]     error = {
2025-05-14T12:58:27.394Z [container-agent]         "message": str(exception),
2025-05-14T12:58:27.394Z [container-agent]         "code": exception.code,
2025-05-14T12:58:27.394Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T12:58:27.394Z [container-agent]     }
2025-05-14T12:58:27.394Z [container-agent] else:
2025-05-14T12:58:27.394Z [container-agent]     error = None
2025-05-14T12:58:27.394Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T12:58:27.394Z [container-agent]     json.dump(error, file)
2025-05-14T12:58:27.394Z [container-agent] 
2025-05-14T12:58:27.394Z [container-agent] stderr:
2025-05-14T12:58:27.394Z [container-agent] Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory
2025-05-14T12:58:27.394Z [container-agent] MySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)
2025-05-14T12:58:27.394Z [container-agent] 
2025-05-14T12:58:27.394Z [container-agent] Traceback (most recent call last):
2025-05-14T12:58:27.394Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T12:58:27.394Z [container-agent]     output, _ = process.wait_output()
2025-05-14T12:58:27.394Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T12:58:27.394Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T12:58:27.394Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T12:58:27.394Z [container-agent] 
2025-05-14T12:58:27.394Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T12:58:27.394Z [container-agent] 
2025-05-14T12:58:27.394Z [container-agent] Traceback (most recent call last):
2025-05-14T12:58:27.394Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T12:58:27.394Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T12:58:27.394Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:27.394Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:27.394Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T12:58:27.394Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T12:58:27.394Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:27.394Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:27.394Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T12:58:27.394Z [container-agent]     raise container.CalledProcessError(
2025-05-14T12:58:27.394Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T12:58:27.635Z [container-agent] 2025-05-14 12:58:27 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T12:58:27.635Z [container-agent] Traceback (most recent call last):
2025-05-14T12:58:27.635Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T12:58:27.636Z [container-agent]     output, _ = process.wait_output()
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T12:58:27.636Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T12:58:27.636Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T12:58:27.636Z [container-agent] 
2025-05-14T12:58:27.636Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T12:58:27.636Z [container-agent] 
2025-05-14T12:58:27.636Z [container-agent] Traceback (most recent call last):
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T12:58:27.636Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T12:58:27.636Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T12:58:27.636Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T12:58:27.636Z [container-agent]     framework._emit(event)
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T12:58:27.636Z [container-agent]     self._reemit(event_path)
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T12:58:27.636Z [container-agent]     custom_handler(event)
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:27.636Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 375, in reconcile
2025-05-14T12:58:27.636Z [container-agent]     self.set_status(event=event)
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:27.636Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 232, in set_status
2025-05-14T12:58:27.636Z [container-agent]     self.unit.status = self._determine_unit_status(event=event)
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:27.636Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/abstract_charm.py", line 217, in _determine_unit_status
2025-05-14T12:58:27.636Z [container-agent]     workload_status = self.get_workload(event=event).status
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/workload.py", line 414, in status
2025-05-14T12:58:27.636Z [container-agent]     if not self.shell.is_router_in_cluster_set(self._router_id):
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 214, in is_router_in_cluster_set
2025-05-14T12:58:27.636Z [container-agent]     self._run_code(
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T12:58:27.636Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:27.636Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T12:58:27.636Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:27.636Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:27.636Z [container-agent]   File "/var/lib/juju/agents/unit-neutron-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T12:58:27.636Z [container-agent]     raise container.CalledProcessError(
2025-05-14T12:58:27.636Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-83_ee070cdf4b8b49@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T12:58:28.677Z [container-agent] 2025-05-14 12:58:28 ERROR juju.worker.uniter.operation runhook.go:180 hook "start" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T12:58:28.686Z [container-agent] 2025-05-14 12:58:28 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T12:58:33.728Z [container-agent] 2025-05-14 12:58:33 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T12:58:36.632Z [pebble] Check "readiness" failure 6/3: non-2xx status code 418
2025-05-14T12:58:46.515Z [pebble] Check "readiness" failure 7/3: non-2xx status code 418
2025-05-14T12:58:47.103Z [container-agent] 2025-05-14 12:58:47 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:52.345Z [container-agent] 2025-05-14 12:58:52 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:52.655Z [container-agent] 2025-05-14 12:58:52 INFO juju-log Unable to connect to endpoint='neutron-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:55.703Z [container-agent] 2025-05-14 12:58:55 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T12:59:10.023Z [container-agent] 2025-05-14 12:59:10 INFO juju.worker.uniter.operation runhook.go:186 ran "mysql-router-pebble-ready" hook (via hook dispatching script: dispatch)
2025-05-14T13:02:27.402Z [container-agent] 2025-05-14 13:02:27 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:07:45.064Z [container-agent] 2025-05-14 13:07:45 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:12:47.305Z [container-agent] 2025-05-14 13:12:47 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:18:27.801Z [container-agent] 2025-05-14 13:18:27 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:23:16.862Z [container-agent] 2025-05-14 13:23:16 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:28:47.774Z [container-agent] 2025-05-14 13:28:47 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:33:39.173Z [container-agent] 2025-05-14 13:33:39 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:39:31.923Z [container-agent] 2025-05-14 13:39:31 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:44:19.973Z [container-agent] 2025-05-14 13:44:19 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:07:24.643Z [container-agent] 2025-05-14 14:07:24 INFO juju.worker.logger logger.go:136 logger worker stopped
2025-05-14T14:07:24.669Z [container-agent] 2025-05-14 14:07:24 ERROR juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: api connection broken unexpectedly
2025-05-14T14:07:24.835Z [container-agent] 2025-05-14 14:07:24 ERROR juju.worker.uniter agent.go:33 resolver loop error: preparing operation "run update-status hook" for neutron-mysql-router/0: getting unit payloads: connection is shut down
2025-05-14T14:07:24.904Z [container-agent] 2025-05-14 14:07:24 ERROR juju.worker.uniter agent.go:36 updating agent status: connection is shut down
2025-05-14T14:07:24.904Z [container-agent] 2025-05-14 14:07:24 INFO juju.worker.uniter uniter.go:349 unit "neutron-mysql-router/0" shutting down: preparing operation "run update-status hook" for neutron-mysql-router/0: getting unit payloads: connection is shut down
2025-05-14T14:07:27.995Z [container-agent] 2025-05-14 14:07:27 INFO juju.api apiclient.go:979 cannot resolve "controller-service.controller-sunbeam-controller.svc.cluster.local": lookup controller-service.controller-sunbeam-controller.svc.cluster.local: operation was canceled
2025-05-14T14:07:27.995Z [container-agent] 2025-05-14 14:07:27 INFO juju.api apiclient.go:601 connection established to "wss://10.152.183.59:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T14:07:28.025Z [container-agent] 2025-05-14 14:07:28 INFO juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: [ee070c] "unit-neutron-mysql-router-0" cannot open api: try again (try again)
2025-05-14T14:07:31.764Z [container-agent] 2025-05-14 14:07:31 INFO juju.api apiclient.go:601 connection established to "wss://controller-service.controller-sunbeam-controller.svc.cluster.local:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T14:07:31.818Z [container-agent] 2025-05-14 14:07:31 INFO juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: [ee070c] "unit-neutron-mysql-router-0" cannot open api: try again (try again)
2025-05-14T14:07:35.935Z [container-agent] 2025-05-14 14:07:35 INFO juju.api apiclient.go:601 connection established to "wss://10.152.183.59:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T14:07:35.943Z [container-agent] 2025-05-14 14:07:35 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-neutron-mysql-router-0" successfully connected to "wss://10.152.183.59:17070"
2025-05-14T14:07:36.016Z [container-agent] 2025-05-14 14:07:35 INFO juju.worker.migrationminion worker.go:208 migration phase is now: NONE
2025-05-14T14:07:36.063Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.logger logger.go:120 logger worker started
2025-05-14T14:07:36.063Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.caasupgrader upgrader.go:113 abort check blocked until version event received
2025-05-14T14:07:36.063Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.caasupgrader upgrader.go:119 unblocking abort check
2025-05-14T14:07:36.128Z [container-agent] 2025-05-14 14:07:36 WARNING juju.worker.proxyupdater proxyupdater.go:237 unable to set snap core settings [proxy.http= proxy.https= proxy.store=]: exec: "snap": executable file not found in $PATH, output: ""
2025-05-14T14:07:36.172Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.leadership tracker.go:244 neutron-mysql-router/0 promoted to leadership of neutron-mysql-router
2025-05-14T14:07:36.183Z [container-agent] 2025-05-14 14:07:36 INFO juju.agent.tools symlinks.go:20 ensure jujuc symlinks in /var/lib/juju/tools/unit-neutron-mysql-router-0
2025-05-14T14:07:36.750Z [pebble] Check "readiness" failure 1/3: non-2xx status code 418
2025-05-14T14:07:36.928Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.uniter uniter.go:365 unit "neutron-mysql-router/0" started
2025-05-14T14:07:36.960Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.uniter uniter.go:391 hooks are retried true
2025-05-14T14:07:37.310Z [container-agent] 2025-05-14 14:07:37 INFO juju.worker.uniter resolver.go:76 reboot detected; triggering implicit start hook to notify charm
2025-05-14T14:07:46.740Z [pebble] Check "readiness" failure 2/3: non-2xx status code 418
2025-05-14T14:07:56.711Z [pebble] Check "readiness" failure 3/3: non-2xx status code 418
2025-05-14T14:07:56.711Z [pebble] Check "readiness" threshold 3 hit, triggering action and recovering
2025-05-14T14:07:56.711Z [pebble] Change 67 task (Perform HTTP check "readiness") failed: non-2xx status code 418
2025-05-14T14:07:59.889Z [container-agent] 2025-05-14 14:07:59 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T14:08:19.635Z [container-agent] 2025-05-14 14:08:19 INFO juju.worker.uniter.operation runhook.go:186 ran "mysql-router-pebble-ready" hook (via hook dispatching script: dispatch)
2025-05-14T14:12:18.970Z [container-agent] 2025-05-14 14:12:18 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:16:51.819Z [container-agent] 2025-05-14 14:16:51 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:22:06.165Z [container-agent] 2025-05-14 14:22:06 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:26:40.588Z [container-agent] 2025-05-14 14:26:40 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:32:06.646Z [container-agent] 2025-05-14 14:32:06 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:36:53.890Z [container-agent] 2025-05-14 14:36:53 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:42:18.999Z [container-agent] 2025-05-14 14:42:18 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:47:46.551Z [container-agent] 2025-05-14 14:47:46 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:52:10.435Z [container-agent] 2025-05-14 14:52:10 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:57:22.989Z [container-agent] 2025-05-14 14:57:22 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T15:01:50.545Z [container-agent] 2025-05-14 15:01:50 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T15:05:58.009Z [container-agent] 2025-05-14 15:05:58 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
