2025-05-14T07:08:07.910Z [pebble] HTTP API server listening on ":38812".
2025-05-14T07:08:07.910Z [pebble] Started daemon.
2025-05-14T07:08:08.324Z [pebble] POST /v1/services 369.170452ms 202
2025-05-14T07:08:08.472Z [pebble] Service "container-agent" starting: /charm/bin/containeragent unit --data-dir /var/lib/juju --append-env "PATH=$PATH:/charm/bin" --show-log --charm-modified-version 0
2025-05-14T07:08:09.708Z [pebble] GET /v1/changes/70/wait 1.377924463s 200
2025-05-14T07:08:09.710Z [pebble] Started default services with change 70.
2025-05-14T07:08:09.854Z [container-agent] 2025-05-14 07:08:09 INFO juju.cmd supercommand.go:56 running containerAgent [3.6.5 33b026f4ab2a4fe371764b9c41993d3e1e90ddef gc go1.24.1]
2025-05-14T07:08:09.855Z [container-agent] starting containeragent unit command
2025-05-14T07:08:09.868Z [container-agent] containeragent unit "unit-nova-cell-mysql-router-0" start (3.6.5 [gc])
2025-05-14T07:08:09.885Z [container-agent] 2025-05-14 07:08:09 INFO juju.cmd.containeragent.unit runner.go:592 start "unit"
2025-05-14T07:08:09.885Z [container-agent] 2025-05-14 07:08:09 INFO juju.worker.upgradesteps worker.go:60 upgrade steps for 3.6.5 have already been run.
2025-05-14T07:08:09.990Z [container-agent] 2025-05-14 07:08:09 INFO juju.worker.probehttpserver server.go:157 starting http server on 127.0.0.1:65301
2025-05-14T07:08:10.051Z [container-agent] 2025-05-14 07:08:10 INFO juju.api apiclient.go:601 connection established to "wss://10.152.183.59:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T07:08:10.051Z [container-agent] 2025-05-14 07:08:10 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-nova-cell-mysql-router-0" successfully connected to "wss://10.152.183.59:17070"
2025-05-14T07:08:10.326Z [container-agent] 2025-05-14 07:08:10 INFO juju.api apiclient.go:979 cannot resolve "controller-service.controller-sunbeam-controller.svc.cluster.local": lookup controller-service.controller-sunbeam-controller.svc.cluster.local: operation was canceled
2025-05-14T07:08:10.326Z [container-agent] 2025-05-14 07:08:10 INFO juju.api apiclient.go:601 connection established to "wss://172.16.1.201:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T07:08:10.412Z [container-agent] 2025-05-14 07:08:10 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-nova-cell-mysql-router-0" successfully connected to "wss://172.16.1.201:17070"
2025-05-14T07:08:10.528Z [container-agent] 2025-05-14 07:08:10 INFO juju.worker.migrationminion worker.go:208 migration phase is now: NONE
2025-05-14T07:08:10.631Z [container-agent] 2025-05-14 07:08:10 INFO juju.worker.logger logger.go:120 logger worker started
2025-05-14T07:08:10.743Z [container-agent] 2025-05-14 07:08:10 INFO juju.worker.caasupgrader upgrader.go:113 abort check blocked until version event received
2025-05-14T07:08:10.788Z [container-agent] 2025-05-14 07:08:10 INFO juju.worker.leadership tracker.go:244 nova-cell-mysql-router/0 promoted to leadership of nova-cell-mysql-router
2025-05-14T07:08:10.788Z [container-agent] 2025-05-14 07:08:10 WARNING juju.worker.proxyupdater proxyupdater.go:237 unable to set snap core settings [proxy.http= proxy.https= proxy.store=]: exec: "snap": executable file not found in $PATH, output: ""
2025-05-14T07:08:10.788Z [container-agent] 2025-05-14 07:08:10 INFO juju.worker.caasupgrader upgrader.go:119 unblocking abort check
2025-05-14T07:08:10.991Z [container-agent] 2025-05-14 07:08:10 INFO juju.agent.tools symlinks.go:20 ensure jujuc symlinks in /var/lib/juju/tools/unit-nova-cell-mysql-router-0
2025-05-14T07:08:11.990Z [container-agent] 2025-05-14 07:08:11 INFO juju.worker.uniter uniter.go:365 unit "nova-cell-mysql-router/0" started
2025-05-14T07:08:12.088Z [container-agent] 2025-05-14 07:08:12 INFO juju.worker.uniter uniter.go:391 hooks are retried true
2025-05-14T07:08:12.707Z [container-agent] 2025-05-14 07:08:12 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T07:08:12.787Z [container-agent] 2025-05-14 07:08:12 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T07:08:17.028Z [container-agent] 2025-05-14 07:08:17 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T07:08:17.802Z [container-agent] 2025-05-14 07:08:17 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T07:08:18.148Z [pebble] Check "readiness" failure 1/3: non-2xx status code 418
2025-05-14T07:08:28.191Z [pebble] Check "readiness" failure 2/3: non-2xx status code 418
2025-05-14T07:08:38.127Z [pebble] Check "readiness" failure 3/3: non-2xx status code 418
2025-05-14T07:08:38.127Z [pebble] Check "readiness" threshold 3 hit, triggering action and recovering
2025-05-14T07:08:38.129Z [pebble] Change 68 task (Perform HTTP check "readiness") failed: non-2xx status code 418
2025-05-14T07:08:48.347Z [pebble] Check "readiness" failure 4/3: non-2xx status code 418
2025-05-14T07:08:52.454Z [container-agent] 2025-05-14 07:08:52 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T07:08:53.076Z [container-agent] 2025-05-14 07:08:53 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T07:08:58.300Z [pebble] Check "readiness" failure 5/3: non-2xx status code 418
2025-05-14T07:09:03.383Z [container-agent] 2025-05-14 07:09:03 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T07:09:03.477Z [container-agent] 2025-05-14 07:09:03 INFO juju.worker.uniter resolver.go:76 reboot detected; triggering implicit start hook to notify charm
2025-05-14T07:09:39.176Z [container-agent] 2025-05-14 07:09:39 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T07:10:09.956Z [container-agent] 2025-05-14 07:10:09 INFO juju.worker.uniter.operation runhook.go:186 ran "mysql-router-pebble-ready" hook (via hook dispatching script: dispatch)
2025-05-14T07:13:45.367Z [container-agent] 2025-05-14 07:13:45 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:18:59.934Z [container-agent] 2025-05-14 07:18:59 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:23:49.948Z [container-agent] 2025-05-14 07:23:49 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:28:15.405Z [container-agent] 2025-05-14 07:28:15 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:33:18.265Z [container-agent] 2025-05-14 07:33:18 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:37:42.530Z [container-agent] 2025-05-14 07:37:42 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:43:11.625Z [container-agent] 2025-05-14 07:43:11 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:47:25.798Z [container-agent] 2025-05-14 07:47:25 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:51:41.006Z [container-agent] 2025-05-14 07:51:41 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T07:56:42.200Z [container-agent] 2025-05-14 07:56:42 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:02:17.617Z [container-agent] 2025-05-14 08:02:17 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:07:03.744Z [container-agent] 2025-05-14 08:07:03 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:11:13.282Z [container-agent] 2025-05-14 08:11:13 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:16:16.605Z [container-agent] 2025-05-14 08:16:16 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:21:57.312Z [container-agent] 2025-05-14 08:21:57 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:27:33.438Z [container-agent] 2025-05-14 08:27:33 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:33:26.668Z [container-agent] 2025-05-14 08:33:26 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:38:16.041Z [container-agent] 2025-05-14 08:38:16 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:43:34.689Z [container-agent] 2025-05-14 08:43:34 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:48:19.427Z [container-agent] 2025-05-14 08:48:19 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:54:11.245Z [container-agent] 2025-05-14 08:54:11 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T08:59:23.161Z [container-agent] 2025-05-14 08:59:23 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:04:16.086Z [container-agent] 2025-05-14 09:04:16 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:08:41.586Z [container-agent] 2025-05-14 09:08:41 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:13:09.933Z [container-agent] 2025-05-14 09:13:09 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:17:29.708Z [container-agent] 2025-05-14 09:17:29 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:21:38.217Z [container-agent] 2025-05-14 09:21:38 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:26:25.663Z [container-agent] 2025-05-14 09:26:25 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:31:39.353Z [container-agent] 2025-05-14 09:31:39 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:37:22.514Z [container-agent] 2025-05-14 09:37:22 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:43:10.941Z [container-agent] 2025-05-14 09:43:10 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:48:08.800Z [container-agent] 2025-05-14 09:48:08 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:53:23.764Z [container-agent] 2025-05-14 09:53:23 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T09:57:33.148Z [container-agent] 2025-05-14 09:57:33 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:01:37.896Z [container-agent] 2025-05-14 10:01:37 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:06:35.880Z [container-agent] 2025-05-14 10:06:35 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:11:46.408Z [container-agent] 2025-05-14 10:11:46 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:15:49.914Z [container-agent] 2025-05-14 10:15:49 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:21:17.330Z [container-agent] 2025-05-14 10:21:17 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:26:12.261Z [container-agent] 2025-05-14 10:26:12 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T10:31:23.502Z [container-agent] 2025-05-14 10:31:23 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:22:25.170Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: api connection broken unexpectedly
2025-05-14T11:22:25.211Z [container-agent] 2025-05-14 11:22:25 INFO juju.worker.logger logger.go:136 logger worker stopped
2025-05-14T11:22:25.307Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.uniter agent.go:33 resolver loop error: preparing operation "run update-status hook" for nova-cell-mysql-router/0: getting unit payloads: connection is shut down
2025-05-14T11:22:25.361Z [container-agent] 2025-05-14 11:22:25 ERROR juju.worker.uniter agent.go:36 updating agent status: connection is shut down
2025-05-14T11:22:25.368Z [container-agent] 2025-05-14 11:22:25 INFO juju.worker.uniter uniter.go:349 unit "nova-cell-mysql-router/0" shutting down: preparing operation "run update-status hook" for nova-cell-mysql-router/0: getting unit payloads: connection is shut down
2025-05-14T11:22:29.847Z [container-agent] 2025-05-14 11:22:29 INFO juju.api apiclient.go:601 connection established to "wss://172.16.1.201:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T11:22:31.597Z [container-agent] 2025-05-14 11:22:31 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-nova-cell-mysql-router-0" successfully connected to "wss://172.16.1.201:17070"
2025-05-14T11:22:32.591Z [container-agent] 2025-05-14 11:22:32 INFO juju.worker.logger logger.go:120 logger worker started
2025-05-14T11:22:32.986Z [container-agent] 2025-05-14 11:22:32 INFO juju.worker.migrationminion worker.go:208 migration phase is now: NONE
2025-05-14T11:22:34.804Z [container-agent] 2025-05-14 11:22:34 WARNING juju.worker.proxyupdater proxyupdater.go:237 unable to set snap core settings [proxy.http= proxy.https= proxy.store=]: exec: "snap": executable file not found in $PATH, output: ""
2025-05-14T11:22:36.176Z [container-agent] 2025-05-14 11:22:36 INFO juju.agent.tools symlinks.go:20 ensure jujuc symlinks in /var/lib/juju/tools/unit-nova-cell-mysql-router-0
2025-05-14T11:22:36.356Z [container-agent] 2025-05-14 11:22:36 INFO juju.worker.caasupgrader upgrader.go:113 abort check blocked until version event received
2025-05-14T11:22:36.356Z [container-agent] 2025-05-14 11:22:36 INFO juju.worker.caasupgrader upgrader.go:119 unblocking abort check
2025-05-14T11:22:36.697Z [container-agent] 2025-05-14 11:22:36 INFO juju.worker.leadership tracker.go:244 nova-cell-mysql-router/0 promoted to leadership of nova-cell-mysql-router
2025-05-14T11:22:39.010Z [pebble] Check "readiness" failure 1/3: non-2xx status code 418
2025-05-14T11:22:42.661Z [container-agent] 2025-05-14 11:22:42 INFO juju.worker.uniter uniter.go:365 unit "nova-cell-mysql-router/0" started
2025-05-14T11:22:42.974Z [container-agent] 2025-05-14 11:22:42 INFO juju.worker.uniter uniter.go:391 hooks are retried true
2025-05-14T11:22:45.109Z [container-agent] 2025-05-14 11:22:45 INFO juju.worker.uniter resolver.go:76 reboot detected; triggering implicit start hook to notify charm
2025-05-14T11:22:48.735Z [pebble] Check "readiness" failure 2/3: non-2xx status code 418
2025-05-14T11:22:59.121Z [pebble] Check "readiness" failure 3/3: non-2xx status code 418
2025-05-14T11:22:59.121Z [pebble] Check "readiness" threshold 3 hit, triggering action and recovering
2025-05-14T11:22:59.121Z [pebble] Change 72 task (Perform HTTP check "readiness") failed: non-2xx status code 418
2025-05-14T11:23:09.684Z [pebble] Check "readiness" failure 4/3: non-2xx status code 418
2025-05-14T11:23:18.520Z [container-agent] 2025-05-14 11:23:18 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T11:23:19.560Z [pebble] Check "readiness" failure 5/3: non-2xx status code 418
2025-05-14T11:23:24.524Z [container-agent] 2025-05-14 11:23:24 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T11:23:24.525Z [container-agent] import json
2025-05-14T11:23:24.525Z [container-agent] import mysqlsh
2025-05-14T11:23:24.525Z [container-agent] import traceback
2025-05-14T11:23:24.525Z [container-agent] 
2025-05-14T11:23:24.525Z [container-agent] try:
2025-05-14T11:23:24.525Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T11:23:24.525Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T11:23:24.525Z [container-agent]     import json
2025-05-14T11:23:24.525Z [container-agent] 
2025-05-14T11:23:24.525Z [container-agent]     cluster_set = dba.get_cluster_set()
2025-05-14T11:23:24.525Z [container-agent]     routers = cluster_set.list_routers()
2025-05-14T11:23:24.525Z [container-agent]     # mysqlsh objects are weird—they quack (i.e. duck typing) like standard Python objects (e.g. list,
2025-05-14T11:23:24.525Z [container-agent]     # dict), but do not serialize to JSON correctly.
2025-05-14T11:23:24.525Z [container-agent]     # Cast to str & load from JSON str before serializing
2025-05-14T11:23:24.525Z [container-agent]     routers = json.loads(str(routers))
2025-05-14T11:23:24.525Z [container-agent]     with open("/tmp/mysqlsh_output.json", "w") as file:
2025-05-14T11:23:24.526Z [container-agent]         json.dump(routers, file)
2025-05-14T11:23:24.526Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T11:23:24.526Z [container-agent]     error = {
2025-05-14T11:23:24.526Z [container-agent]         "message": str(exception),
2025-05-14T11:23:24.526Z [container-agent]         "code": exception.code,
2025-05-14T11:23:24.526Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T11:23:24.527Z [container-agent]     }
2025-05-14T11:23:24.527Z [container-agent] else:
2025-05-14T11:23:24.527Z [container-agent]     error = None
2025-05-14T11:23:24.527Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T11:23:24.527Z [container-agent]     json.dump(error, file)
2025-05-14T11:23:24.527Z [container-agent] 
2025-05-14T11:23:24.527Z [container-agent] stderr:
2025-05-14T11:23:24.527Z [container-agent] Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory
2025-05-14T11:23:24.527Z [container-agent] MySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)
2025-05-14T11:23:24.527Z [container-agent] 
2025-05-14T11:23:24.527Z [container-agent] Traceback (most recent call last):
2025-05-14T11:23:24.527Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T11:23:24.527Z [container-agent]     output, _ = process.wait_output()
2025-05-14T11:23:24.527Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T11:23:24.528Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T11:23:24.528Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T11:23:24.528Z [container-agent] 
2025-05-14T11:23:24.528Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T11:23:24.528Z [container-agent] 
2025-05-14T11:23:24.528Z [container-agent] Traceback (most recent call last):
2025-05-14T11:23:24.528Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T11:23:24.528Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T11:23:24.528Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:24.528Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:24.528Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T11:23:24.528Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T11:23:24.528Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:24.528Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:24.528Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T11:23:24.528Z [container-agent]     raise container.CalledProcessError(
2025-05-14T11:23:24.528Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T11:23:24.738Z [container-agent] 2025-05-14 11:23:24 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T11:23:24.738Z [container-agent] Traceback (most recent call last):
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T11:23:24.738Z [container-agent]     output, _ = process.wait_output()
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T11:23:24.738Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T11:23:24.738Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T11:23:24.738Z [container-agent] 
2025-05-14T11:23:24.738Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T11:23:24.738Z [container-agent] 
2025-05-14T11:23:24.738Z [container-agent] Traceback (most recent call last):
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T11:23:24.738Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T11:23:24.738Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T11:23:24.738Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T11:23:24.738Z [container-agent]     framework._emit(event)
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T11:23:24.738Z [container-agent]     self._reemit(event_path)
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T11:23:24.738Z [container-agent]     custom_handler(event)
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:24.738Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/abstract_charm.py", line 371, in reconcile
2025-05-14T11:23:24.738Z [container-agent]     if not workload_.status or workload_.status == ops.WaitingStatus():
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/workload.py", line 414, in status
2025-05-14T11:23:24.738Z [container-agent]     if not self.shell.is_router_in_cluster_set(self._router_id):
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/mysql_shell/__init__.py", line 214, in is_router_in_cluster_set
2025-05-14T11:23:24.738Z [container-agent]     self._run_code(
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T11:23:24.738Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:24.738Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T11:23:24.738Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T11:23:24.738Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T11:23:24.738Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T11:23:24.738Z [container-agent]     raise container.CalledProcessError(
2025-05-14T11:23:24.738Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T11:23:26.377Z [container-agent] 2025-05-14 11:23:26 ERROR juju.worker.uniter.operation runhook.go:180 hook "start" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T11:23:26.457Z [container-agent] 2025-05-14 11:23:26 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T11:23:29.422Z [pebble] Check "readiness" failure 6/3: non-2xx status code 418
2025-05-14T11:23:31.514Z [container-agent] 2025-05-14 11:23:31 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "start" hook
2025-05-14T11:23:39.428Z [pebble] Check "readiness" failure 7/3: non-2xx status code 418
2025-05-14T11:23:49.197Z [container-agent] 2025-05-14 11:23:49 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T11:23:49.457Z [pebble] Check "readiness" failure 8/3: non-2xx status code 418
2025-05-14T11:23:59.442Z [pebble] Check "readiness" failure 9/3: non-2xx status code 418
2025-05-14T11:24:00.372Z [container-agent] 2025-05-14 11:24:00 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T11:24:01.147Z [container-agent] 2025-05-14 11:24:01 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T11:24:09.550Z [pebble] Check "readiness" failure 10/3: non-2xx status code 418
2025-05-14T11:24:11.295Z [container-agent] 2025-05-14 11:24:11 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T11:24:49.391Z [container-agent] 2025-05-14 11:24:49 INFO juju.worker.uniter.operation runhook.go:186 ran "mysql-router-pebble-ready" hook (via hook dispatching script: dispatch)
2025-05-14T11:27:10.590Z [container-agent] 2025-05-14 11:27:10 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:31:21.071Z [container-agent] 2025-05-14 11:31:21 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:37:25.097Z [container-agent] 2025-05-14 11:37:25 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:42:41.164Z [container-agent] 2025-05-14 11:42:41 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:48:17.397Z [container-agent] 2025-05-14 11:48:17 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:52:22.018Z [container-agent] 2025-05-14 11:52:22 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T11:57:10.937Z [container-agent] 2025-05-14 11:57:10 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:02:13.515Z [container-agent] 2025-05-14 12:02:13 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:06:31.628Z [container-agent] 2025-05-14 12:06:31 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:11:00.250Z [container-agent] 2025-05-14 12:11:00 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:15:17.740Z [container-agent] 2025-05-14 12:15:17 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:20:02.899Z [container-agent] 2025-05-14 12:20:02 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:24:44.961Z [container-agent] 2025-05-14 12:24:44 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:28:54.829Z [container-agent] 2025-05-14 12:28:54 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:33:01.371Z [container-agent] 2025-05-14 12:33:01 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:38:25.241Z [container-agent] 2025-05-14 12:38:25 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:42:37.287Z [container-agent] 2025-05-14 12:42:37 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:48:29.870Z [container-agent] 2025-05-14 12:48:29 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:52:33.469Z [container-agent] 2025-05-14 12:52:33 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:57:31.671Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "migration-minion" manifold worker returned unexpected error: hub txn watcher sync error: starting change stream: read tcp 127.0.0.1:50396->127.0.0.1:37017: i/o timeout
2025-05-14T12:57:31.674Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "log-sender" manifold worker returned unexpected error: sending log message: write tcp 10.1.0.222:50586->172.16.1.201:17070: write: broken pipe: write tcp 10.1.0.222:50586->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "api-address-updater" manifold worker returned unexpected error: hub txn watcher sync error: starting change stream: read tcp 127.0.0.1:50396->127.0.0.1:37017: i/o timeout
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.763Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "dead-flag" manifold worker returned unexpected error: hub txn watcher sync error: starting change stream: read tcp 127.0.0.1:50396->127.0.0.1:37017: i/o timeout
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "migration-inactive-flag" manifold worker returned unexpected error: hub txn watcher sync error: starting change stream: read tcp 127.0.0.1:50396->127.0.0.1:37017: i/o timeout
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 INFO juju.worker.logger logger.go:136 logger worker stopped
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "upgrader" manifold worker returned unexpected error: hub txn watcher sync error: starting change stream: read tcp 127.0.0.1:50396->127.0.0.1:37017: i/o timeout
2025-05-14T12:57:31.792Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "not-dead-flag" manifold worker returned unexpected error: hub txn watcher sync error: starting change stream: read tcp 127.0.0.1:50396->127.0.0.1:37017: i/o timeout
2025-05-14T12:57:31.805Z [container-agent] 2025-05-14 12:57:31 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: codec.ReadHeader error: error receiving message: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:31.821Z [container-agent] 2025-05-14 12:57:31 ERROR juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: codec.ReadHeader error: error receiving message: write tcp 10.1.0.222:50562->172.16.1.201:17070: write: broken pipe
2025-05-14T12:57:35.668Z [container-agent] 2025-05-14 12:57:35 ERROR juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: [ee070c] "unit-nova-cell-mysql-router-0" cannot open api: unable to connect to API: dial tcp 10.152.183.59:17070: connect: connection refused
2025-05-14T12:57:39.757Z [container-agent] 2025-05-14 12:57:39 INFO juju.api apiclient.go:601 connection established to "wss://10.152.183.59:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T12:57:39.887Z [container-agent] 2025-05-14 12:57:39 INFO juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: [ee070c] "unit-nova-cell-mysql-router-0" cannot open api: try again (try again)
2025-05-14T12:57:44.590Z [container-agent] 2025-05-14 12:57:44 INFO juju.api apiclient.go:979 cannot resolve "controller-service.controller-sunbeam-controller.svc.cluster.local": lookup controller-service.controller-sunbeam-controller.svc.cluster.local on 10.152.183.193:53: dial udp 10.152.183.193:53: connect: operation not permitted
2025-05-14T12:57:44.708Z [container-agent] 2025-05-14 12:57:44 INFO juju.api apiclient.go:601 connection established to "wss://10.152.183.59:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T12:57:45.026Z [container-agent] 2025-05-14 12:57:44 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-nova-cell-mysql-router-0" successfully connected to "wss://10.152.183.59:17070"
2025-05-14T12:57:45.173Z [container-agent] 2025-05-14 12:57:45 INFO juju.worker.logger logger.go:120 logger worker started
2025-05-14T12:57:45.221Z [container-agent] 2025-05-14 12:57:45 INFO juju.worker.migrationminion worker.go:208 migration phase is now: NONE
2025-05-14T12:57:45.314Z [container-agent] 2025-05-14 12:57:45 WARNING juju.worker.proxyupdater proxyupdater.go:237 unable to set snap core settings [proxy.http= proxy.https= proxy.store=]: exec: "snap": executable file not found in $PATH, output: ""
2025-05-14T12:57:45.592Z [container-agent] 2025-05-14 12:57:45 INFO juju.worker.leadership tracker.go:244 nova-cell-mysql-router/0 promoted to leadership of nova-cell-mysql-router
2025-05-14T12:57:45.651Z [container-agent] 2025-05-14 12:57:45 INFO juju.worker.caasupgrader upgrader.go:113 abort check blocked until version event received
2025-05-14T12:57:45.657Z [container-agent] 2025-05-14 12:57:45 INFO juju.worker.caasupgrader upgrader.go:119 unblocking abort check
2025-05-14T12:57:46.804Z [container-agent] 2025-05-14 12:57:46 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T12:57:46.804Z [container-agent] Traceback (most recent call last):
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/model.py", line 2955, in _run
2025-05-14T12:57:46.804Z [container-agent]     result = subprocess.run(args, **kwargs)  # type: ignore
2025-05-14T12:57:46.804Z [container-agent]   File "/usr/lib/python3.10/subprocess.py", line 526, in run
2025-05-14T12:57:46.804Z [container-agent]     raise CalledProcessError(retcode, process.args,
2025-05-14T12:57:46.804Z [container-agent] subprocess.CalledProcessError: Command '('/var/lib/juju/tools/unit-nova-cell-mysql-router-0/relation-get', '-r', '58', '-', 'nova-cell-mysql-router', '--app', '--format=json')' returned non-zero exit status 1.
2025-05-14T12:57:46.804Z [container-agent] 
2025-05-14T12:57:46.804Z [container-agent] The above exception was the direct cause of the following exception:
2025-05-14T12:57:46.804Z [container-agent] 
2025-05-14T12:57:46.804Z [container-agent] Traceback (most recent call last):
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T12:57:46.804Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T12:57:46.804Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T12:57:46.804Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T12:57:46.804Z [container-agent]     framework._emit(event)
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T12:57:46.804Z [container-agent]     self._reemit(event_path)
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T12:57:46.804Z [container-agent]     custom_handler(event)
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:57:46.804Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/abstract_charm.py", line 275, in reconcile
2025-05-14T12:57:46.804Z [container-agent]     if not self._upgrade.versions_set:
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/upgrade.py", line 169, in versions_set
2025-05-14T12:57:46.804Z [container-agent]     return self._app_databag.get("versions") is not None
2025-05-14T12:57:46.804Z [container-agent]   File "/usr/lib/python3.10/_collections_abc.py", line 824, in get
2025-05-14T12:57:46.804Z [container-agent]     return self[key]
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/model.py", line 1685, in __getitem__
2025-05-14T12:57:46.804Z [container-agent]     return super().__getitem__(key)
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/model.py", line 790, in __getitem__
2025-05-14T12:57:46.804Z [container-agent]     return self._data[key]
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/model.py", line 774, in _data
2025-05-14T12:57:46.804Z [container-agent]     data = self._lazy_data = self._load()
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/model.py", line 1569, in _load
2025-05-14T12:57:46.804Z [container-agent]     return self._backend.relation_get(self.relation.id, self._entity.name, self._is_app)
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/model.py", line 3036, in relation_get
2025-05-14T12:57:46.804Z [container-agent]     raw_data_content = self._run(*args, return_output=True, use_json=True)
2025-05-14T12:57:46.804Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/model.py", line 2957, in _run
2025-05-14T12:57:46.804Z [container-agent]     raise ModelError(e.stderr) from e
2025-05-14T12:57:46.804Z [container-agent] ops.model.ModelError: ERROR connection is shut down
2025-05-14T12:57:46.804Z [container-agent] 
2025-05-14T12:57:49.020Z [container-agent] 2025-05-14 12:57:48 ERROR juju.worker.uniter.operation runhook.go:180 hook "update-status" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T12:57:49.040Z [container-agent] 2025-05-14 12:57:49 INFO juju.worker.uniter uniter.go:349 unit "nova-cell-mysql-router/0" shutting down: (re)starting watcher: connection is shut down
2025-05-14T12:57:49.205Z [container-agent] 2025-05-14 12:57:49 INFO juju.agent.tools symlinks.go:20 ensure jujuc symlinks in /var/lib/juju/tools/unit-nova-cell-mysql-router-0
2025-05-14T12:57:50.292Z [pebble] Check "readiness" failure 1/3: non-2xx status code 418
2025-05-14T12:57:51.367Z [container-agent] 2025-05-14 12:57:51 INFO juju.worker.uniter uniter.go:365 unit "nova-cell-mysql-router/0" started
2025-05-14T12:57:51.508Z [container-agent] 2025-05-14 12:57:51 INFO juju.worker.uniter uniter.go:391 hooks are retried true
2025-05-14T12:57:52.607Z [container-agent] 2025-05-14 12:57:52 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T12:57:56.369Z [container-agent] 2025-05-14 12:57:56 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T12:57:57.710Z [container-agent] 2025-05-14 12:57:57 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T12:58:00.304Z [pebble] Check "readiness" failure 2/3: non-2xx status code 418
2025-05-14T12:58:10.050Z [pebble] Check "readiness" failure 3/3: non-2xx status code 418
2025-05-14T12:58:10.050Z [pebble] Check "readiness" threshold 3 hit, triggering action and recovering
2025-05-14T12:58:10.054Z [pebble] Change 74 task (Perform HTTP check "readiness") failed: non-2xx status code 418
2025-05-14T12:58:16.080Z [container-agent] 2025-05-14 12:58:16 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:20.200Z [pebble] Check "readiness" failure 4/3: non-2xx status code 418
2025-05-14T12:58:21.350Z [container-agent] 2025-05-14 12:58:21 ERROR juju-log Failed to run MySQL Shell script:
2025-05-14T12:58:21.350Z [container-agent] import json
2025-05-14T12:58:21.350Z [container-agent] import mysqlsh
2025-05-14T12:58:21.350Z [container-agent] import traceback
2025-05-14T12:58:21.350Z [container-agent] 
2025-05-14T12:58:21.350Z [container-agent] try:
2025-05-14T12:58:21.350Z [container-agent]     # Disable wizards in this script, since it will be invoked without --no-wizard
2025-05-14T12:58:21.350Z [container-agent]     shell.options.set('useWizards', False)
2025-05-14T12:58:21.350Z [container-agent]     import json
2025-05-14T12:58:21.350Z [container-agent] 
2025-05-14T12:58:21.350Z [container-agent]     cluster_set = dba.get_cluster_set()
2025-05-14T12:58:21.350Z [container-agent]     routers = cluster_set.list_routers()
2025-05-14T12:58:21.350Z [container-agent]     # mysqlsh objects are weird—they quack (i.e. duck typing) like standard Python objects (e.g. list,
2025-05-14T12:58:21.350Z [container-agent]     # dict), but do not serialize to JSON correctly.
2025-05-14T12:58:21.350Z [container-agent]     # Cast to str & load from JSON str before serializing
2025-05-14T12:58:21.350Z [container-agent]     routers = json.loads(str(routers))
2025-05-14T12:58:21.350Z [container-agent]     with open("/tmp/mysqlsh_output.json", "w") as file:
2025-05-14T12:58:21.350Z [container-agent]         json.dump(routers, file)
2025-05-14T12:58:21.350Z [container-agent] except mysqlsh.DBError as exception:
2025-05-14T12:58:21.350Z [container-agent]     error = {
2025-05-14T12:58:21.350Z [container-agent]         "message": str(exception),
2025-05-14T12:58:21.350Z [container-agent]         "code": exception.code,
2025-05-14T12:58:21.350Z [container-agent]         "traceback_message": "".join(traceback.format_exception(exception)),
2025-05-14T12:58:21.350Z [container-agent]     }
2025-05-14T12:58:21.350Z [container-agent] else:
2025-05-14T12:58:21.350Z [container-agent]     error = None
2025-05-14T12:58:21.350Z [container-agent] with open("/tmp/mysqlsh_error.json", "w") as file:
2025-05-14T12:58:21.350Z [container-agent]     json.dump(error, file)
2025-05-14T12:58:21.350Z [container-agent] 
2025-05-14T12:58:21.350Z [container-agent] stderr:
2025-05-14T12:58:21.350Z [container-agent] Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory
2025-05-14T12:58:21.350Z [container-agent] MySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)
2025-05-14T12:58:21.350Z [container-agent] 
2025-05-14T12:58:21.350Z [container-agent] Traceback (most recent call last):
2025-05-14T12:58:21.350Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T12:58:21.350Z [container-agent]     output, _ = process.wait_output()
2025-05-14T12:58:21.350Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T12:58:21.350Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T12:58:21.350Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T12:58:21.350Z [container-agent] 
2025-05-14T12:58:21.350Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T12:58:21.350Z [container-agent] 
2025-05-14T12:58:21.350Z [container-agent] Traceback (most recent call last):
2025-05-14T12:58:21.350Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T12:58:21.350Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T12:58:21.350Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:21.350Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:21.350Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T12:58:21.350Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T12:58:21.350Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:21.350Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:21.350Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T12:58:21.350Z [container-agent]     raise container.CalledProcessError(
2025-05-14T12:58:21.350Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T12:58:21.568Z [container-agent] 2025-05-14 12:58:21 ERROR juju-log Uncaught exception while in charm code:
2025-05-14T12:58:21.569Z [container-agent] Traceback (most recent call last):
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/rock.py", line 245, in _run_command
2025-05-14T12:58:21.569Z [container-agent]     output, _ = process.wait_output()
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/pebble.py", line 1441, in wait_output
2025-05-14T12:58:21.569Z [container-agent]     raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
2025-05-14T12:58:21.569Z [container-agent] ops.pebble.ExecError: non-zero exit code 1 executing ['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py'], stdout="\x1b[1mPlease provide the password for 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306': \x1b[0m", stderr="Cannot set LC_ALL to locale en_US.UTF-8: No such file or directory\nMySQL Error 2003 (HY000): Can't connect to MySQL server on 'mysql-primary.openstack.svc.cluster.local:3306' (1)\n"
2025-05-14T12:58:21.569Z [container-agent] 
2025-05-14T12:58:21.569Z [container-agent] During handling of the above exception, another exception occurred:
2025-05-14T12:58:21.569Z [container-agent] 
2025-05-14T12:58:21.569Z [container-agent] Traceback (most recent call last):
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/charm.py", line 448, in <module>
2025-05-14T12:58:21.569Z [container-agent]     ops.main.main(KubernetesRouterCharm)
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
2025-05-14T12:58:21.569Z [container-agent]     _emit_charm_event(charm, dispatcher.event_name)
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
2025-05-14T12:58:21.569Z [container-agent]     event_to_emit.emit(*args, **kwargs)
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
2025-05-14T12:58:21.569Z [container-agent]     framework._emit(event)
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
2025-05-14T12:58:21.569Z [container-agent]     self._reemit(event_path)
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
2025-05-14T12:58:21.569Z [container-agent]     custom_handler(event)
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:21.569Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/abstract_charm.py", line 371, in reconcile
2025-05-14T12:58:21.569Z [container-agent]     if not workload_.status or workload_.status == ops.WaitingStatus():
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/workload.py", line 414, in status
2025-05-14T12:58:21.569Z [container-agent]     if not self.shell.is_router_in_cluster_set(self._router_id):
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/mysql_shell/__init__.py", line 214, in is_router_in_cluster_set
2025-05-14T12:58:21.569Z [container-agent]     self._run_code(
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/mysql_shell/__init__.py", line 74, in _run_code
2025-05-14T12:58:21.569Z [container-agent]     self._container.run_mysql_shell(
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:21.569Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/container.py", line 212, in run_mysql_shell
2025-05-14T12:58:21.569Z [container-agent]     return self._run_command(args, timeout=timeout, input=input)
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
2025-05-14T12:58:21.569Z [container-agent]     return callable(*args, **kwargs)  # type: ignore
2025-05-14T12:58:21.569Z [container-agent]   File "/var/lib/juju/agents/unit-nova-cell-mysql-router-0/charm/src/rock.py", line 247, in _run_command
2025-05-14T12:58:21.569Z [container-agent]     raise container.CalledProcessError(
2025-05-14T12:58:21.569Z [container-agent] container.CalledProcessError: Command '['mysqlsh', '--passwords-from-stdin', '--uri', 'relation-108_ee070cdf4b8b4@mysql-primary.openstack.svc.cluster.local:3306', '--python', '--file', '/tmp/mysqlsh_script.py']' returned non-zero exit status 1.
2025-05-14T12:58:22.873Z [container-agent] 2025-05-14 12:58:22 ERROR juju.worker.uniter.operation runhook.go:180 hook "update-status" (via hook dispatching script: dispatch) failed: exit status 1
2025-05-14T12:58:22.890Z [container-agent] 2025-05-14 12:58:22 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T12:58:30.198Z [pebble] Check "readiness" failure 5/3: non-2xx status code 418
2025-05-14T12:58:32.827Z [container-agent] 2025-05-14 12:58:32 INFO juju.worker.uniter resolver.go:180 awaiting error resolution for "update-status" hook
2025-05-14T12:58:40.259Z [pebble] Check "readiness" failure 6/3: non-2xx status code 418
2025-05-14T12:58:45.543Z [container-agent] 2025-05-14 12:58:45 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:50.241Z [pebble] Check "readiness" failure 7/3: non-2xx status code 418
2025-05-14T12:58:51.452Z [container-agent] 2025-05-14 12:58:51 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:51.780Z [container-agent] 2025-05-14 12:58:51 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:58:55.703Z [container-agent] 2025-05-14 12:58:55 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T12:58:55.737Z [container-agent] 2025-05-14 12:58:55 INFO juju.worker.uniter resolver.go:76 reboot detected; triggering implicit start hook to notify charm
2025-05-14T12:59:00.192Z [pebble] Check "readiness" failure 8/3: non-2xx status code 418
2025-05-14T12:59:01.820Z [container-agent] 2025-05-14 12:59:01 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:59:05.689Z [container-agent] 2025-05-14 12:59:05 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:59:05.985Z [container-agent] 2025-05-14 12:59:05 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:59:10.267Z [pebble] Check "readiness" failure 9/3: non-2xx status code 418
2025-05-14T12:59:10.635Z [container-agent] 2025-05-14 12:59:10 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T12:59:14.653Z [container-agent] 2025-05-14 12:59:14 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:59:16.837Z [container-agent] 2025-05-14 12:59:16 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:59:17.035Z [container-agent] 2025-05-14 12:59:17 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T12:59:19.806Z [container-agent] 2025-05-14 12:59:19 INFO juju.worker.uniter.operation runhook.go:186 ran "mysql-router-pebble-ready" hook (via hook dispatching script: dispatch)
2025-05-14T13:02:27.472Z [container-agent] 2025-05-14 13:02:27 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:07:52.572Z [container-agent] 2025-05-14 13:07:52 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:12:42.191Z [container-agent] 2025-05-14 13:12:42 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:18:33.044Z [container-agent] 2025-05-14 13:18:33 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:23:30.848Z [container-agent] 2025-05-14 13:23:30 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:27:42.192Z [container-agent] 2025-05-14 13:27:42 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:32:31.354Z [container-agent] 2025-05-14 13:32:31 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:37:42.208Z [container-agent] 2025-05-14 13:37:42 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T13:43:15.745Z [container-agent] 2025-05-14 13:43:15 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:07:24.579Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.579Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.694Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.723Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.738Z [container-agent] 2025-05-14 14:07:24 ERROR juju.api.watcher watcher.go:95 error trying to stop watcher: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.800Z [container-agent] 2025-05-14 14:07:24 ERROR juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: codec.ReadHeader error: error receiving message: write tcp 10.1.0.222:55722->10.152.183.59:17070: write: broken pipe
2025-05-14T14:07:24.840Z [container-agent] 2025-05-14 14:07:24 INFO juju.worker.logger logger.go:136 logger worker stopped
2025-05-14T14:07:24.872Z [container-agent] 2025-05-14 14:07:24 WARNING juju.worker.uniter.operation leader.go:123 we should run a leader-deposed hook here, but we can't yet
2025-05-14T14:07:24.872Z [container-agent] 2025-05-14 14:07:24 ERROR juju.worker.uniter agent.go:33 resolver loop error: committing operation "resign leadership" for nova-cell-mysql-router/0: writing state: connection is shut down
2025-05-14T14:07:24.872Z [container-agent] 2025-05-14 14:07:24 ERROR juju.worker.uniter agent.go:36 updating agent status: connection is shut down
2025-05-14T14:07:24.872Z [container-agent] 2025-05-14 14:07:24 INFO juju.worker.uniter uniter.go:349 unit "nova-cell-mysql-router/0" shutting down: committing operation "resign leadership" for nova-cell-mysql-router/0: writing state: connection is shut down
2025-05-14T14:07:28.096Z [container-agent] 2025-05-14 14:07:28 INFO juju.api apiclient.go:601 connection established to "wss://172.16.1.201:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T14:07:28.119Z [container-agent] 2025-05-14 14:07:28 INFO juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: [ee070c] "unit-nova-cell-mysql-router-0" cannot open api: try again (try again)
2025-05-14T14:07:31.808Z [container-agent] 2025-05-14 14:07:31 INFO juju.api apiclient.go:979 cannot resolve "controller-service.controller-sunbeam-controller.svc.cluster.local": lookup controller-service.controller-sunbeam-controller.svc.cluster.local: operation was canceled
2025-05-14T14:07:31.810Z [container-agent] 2025-05-14 14:07:31 INFO juju.api apiclient.go:601 connection established to "wss://172.16.1.201:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T14:07:31.853Z [container-agent] 2025-05-14 14:07:31 INFO juju.worker.dependency engine.go:695 "api-caller" manifold worker returned unexpected error: [ee070c] "unit-nova-cell-mysql-router-0" cannot open api: try again (try again)
2025-05-14T14:07:36.144Z [container-agent] 2025-05-14 14:07:36 INFO juju.api apiclient.go:601 connection established to "wss://controller-service.controller-sunbeam-controller.svc.cluster.local:17070/model/ee070cdf-4b8b-49ac-80cb-918841540fbe/api"
2025-05-14T14:07:36.194Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.apicaller connect.go:163 [ee070c] "unit-nova-cell-mysql-router-0" successfully connected to "wss://controller-service.controller-sunbeam-controller.svc.cluster.local:17070"
2025-05-14T14:07:36.366Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.migrationminion worker.go:208 migration phase is now: NONE
2025-05-14T14:07:36.376Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.logger logger.go:120 logger worker started
2025-05-14T14:07:36.395Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.leadership tracker.go:244 nova-cell-mysql-router/0 promoted to leadership of nova-cell-mysql-router
2025-05-14T14:07:36.475Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.caasupgrader upgrader.go:113 abort check blocked until version event received
2025-05-14T14:07:36.475Z [container-agent] 2025-05-14 14:07:36 WARNING juju.worker.proxyupdater proxyupdater.go:237 unable to set snap core settings [proxy.http= proxy.https= proxy.store=]: exec: "snap": executable file not found in $PATH, output: ""
2025-05-14T14:07:36.475Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.caasupgrader upgrader.go:119 unblocking abort check
2025-05-14T14:07:36.478Z [container-agent] 2025-05-14 14:07:36 INFO juju.agent.tools symlinks.go:20 ensure jujuc symlinks in /var/lib/juju/tools/unit-nova-cell-mysql-router-0
2025-05-14T14:07:36.966Z [container-agent] 2025-05-14 14:07:36 INFO juju.worker.uniter uniter.go:365 unit "nova-cell-mysql-router/0" started
2025-05-14T14:07:37.035Z [container-agent] 2025-05-14 14:07:37 INFO juju.worker.uniter uniter.go:391 hooks are retried true
2025-05-14T14:07:37.438Z [container-agent] 2025-05-14 14:07:37 INFO juju.worker.uniter resolver.go:76 reboot detected; triggering implicit start hook to notify charm
2025-05-14T14:07:40.273Z [pebble] Check "readiness" failure 1/3: non-2xx status code 418
2025-05-14T14:07:50.269Z [pebble] Check "readiness" failure 2/3: non-2xx status code 418
2025-05-14T14:08:00.376Z [pebble] Check "readiness" failure 3/3: non-2xx status code 418
2025-05-14T14:08:00.376Z [pebble] Check "readiness" threshold 3 hit, triggering action and recovering
2025-05-14T14:08:00.398Z [pebble] Change 76 task (Perform HTTP check "readiness") failed: non-2xx status code 418
2025-05-14T14:08:01.139Z [container-agent] 2025-05-14 14:08:01 INFO juju.worker.uniter.operation runhook.go:186 ran "start" hook (via hook dispatching script: dispatch)
2025-05-14T14:08:08.252Z [container-agent] 2025-05-14 14:08:08 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T14:08:13.047Z [container-agent] 2025-05-14 14:08:13 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T14:08:13.375Z [container-agent] 2025-05-14 14:08:13 INFO juju-log Unable to connect to endpoint='nova-cell-mysql-router-service.openstack.svc.cluster.local:6446'
2025-05-14T14:08:17.527Z [container-agent] 2025-05-14 14:08:17 INFO juju.worker.uniter.operation runhook.go:186 ran "mysql-router-pebble-ready" hook (via hook dispatching script: dispatch)
2025-05-14T14:12:19.084Z [container-agent] 2025-05-14 14:12:19 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:16:51.973Z [container-agent] 2025-05-14 14:16:51 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:22:06.239Z [container-agent] 2025-05-14 14:22:06 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:26:40.743Z [container-agent] 2025-05-14 14:26:40 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:32:06.676Z [container-agent] 2025-05-14 14:32:06 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:36:54.042Z [container-agent] 2025-05-14 14:36:54 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:42:19.202Z [container-agent] 2025-05-14 14:42:19 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:47:46.547Z [container-agent] 2025-05-14 14:47:46 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:52:10.592Z [container-agent] 2025-05-14 14:52:10 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T14:57:23.168Z [container-agent] 2025-05-14 14:57:23 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T15:01:50.593Z [container-agent] 2025-05-14 15:01:50 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
2025-05-14T15:05:58.013Z [container-agent] 2025-05-14 15:05:58 INFO juju.worker.uniter.operation runhook.go:186 ran "update-status" hook (via hook dispatching script: dispatch)
