# Definitions for config assertions. 
#
# Allows us to assert that config is as expected.
#
# The contents of this file are structured as follows:
#
# PLUGIN:
#   ASSERTION:
#     SETTINGS
#
# NOTE: this is currently only supported by the openstack plugin.
#
# See https://docs.python.org/3/library/operator.html for valid operator
# methods.
#
openstack:
  nova-dpdk:
    config:
      handler: core.plugins.openstack.OpenstackConfig
      path: etc/nova/nova.conf
    requires:
      type: apt
      value: openvswitch-switch-dpdk
    message: >-
      DPDK is enabled but rx_queue_size/tx_queue_size set incorrectly in
      nova.conf (expect both to be >= 1024).
    settings:
      rx_queue_size:
        section: libvirt
        value: 1024
        operator: ge
        allow-unset: False
      tx_queue_size:
        section: libvirt
        value: 1024
        operator: ge
        allow-unset: False
storage:
  bcache:
    cset:
      config:
        handler: core.plugins.storage.bcache.CachesetsConfig
      settings:
        congested_read_threshold_us:
          value: 0
          operator: eq
        congested_write_threshold_us:
          value: 0
          operator: eq
    bdev:
      config:
        handler: core.plugins.storage.bcache.BdevsConfig
      settings:
        sequential_cutoff:
          value: '0.0k'
          operator: eq
        cache_mode:
          value: 'writethrough [writeback] writearound none'
          operator: eq
        writeback_percent:
          value: 10
          operator: ge
