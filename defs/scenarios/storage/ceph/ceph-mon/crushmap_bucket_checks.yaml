checks:
  crushmap_has_mixed_type_buckets:
    requires:
      property:
        path: hotsos.core.plugins.storage.ceph.CephCrushMap.crushmap_mixed_buckets
        ops: [[length_hint], [gt, 0]]
  crushmap_has_unequal_buckets:
    requires:
      property:
        path: hotsos.core.plugins.storage.ceph.CephCrushMap.crushmap_equal_buckets
        ops: [[length_hint], [gt, 0]]
conclusions:
  crushmap-mixed-buckets:
    decision: crushmap_has_mixed_type_buckets
    raises:
      type: hotsos.core.issues.CephCrushWarning
      message: >-
        Mixed crush bucket types identified in buckets '{buckets}'. This can
        cause data distribution to become skewed - please check crush map.
      format-dict:
        buckets: hotsos.core.plugins.storage.ceph.CephCrushMap.crushmap_mixed_buckets_str
  crushmap-unbalanced-buckets:
    decision: crushmap_has_unequal_buckets
    raises:
      type: hotsos.core.issues.CephCrushWarning
      message: >-
        Found one or more unbalanced crush buckets e.g. crush root '{root}' using
        failure domain '{domain}' with rule id '{ruleid}'. This can cause
        data distribution to become skewed - please check crush map.
      format-dict:
        root: hotsos.core.plugins.storage.ceph.CephCrushMap.crushmap_equal_buckets_head_root
        domain: hotsos.core.plugins.storage.ceph.CephCrushMap.crushmap_equal_buckets_head_domain
        ruleid: hotsos.core.plugins.storage.ceph.CephCrushMap.crushmap_equal_buckets_head_ruleid
