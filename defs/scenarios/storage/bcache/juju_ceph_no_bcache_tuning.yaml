checks:
  juju_ceph_osd_charm_enabled:
    requires:
      property: core.plugins.juju.JujuBase.charm_names
      op: contains
      value: ceph-osd
  juju_bcache_tuning_charm_not_enabled:
    requires:
      property: core.plugins.juju.JujuBase.charm_names
      op: contains
      value: bcache-tuning
      post-op: not_
  local_osds_using_bcache:
    requires:
      property: core.plugins.storage.ceph.CephChecksBase.local_osds_use_bcache
conclusions:
  charmed-ceph-osd-no-bcache-tuning:
    decision:
      and:
        - juju_ceph_osd_charm_enabled
        - local_osds_using_bcache
        - juju_bcache_tuning_charm_not_enabled
    raises:
      type: core.issues.BcacheWarning
      message: >-
        This host is running Juju-managed Ceph OSDs that are using bcache
        devices yet the bcache-tuning charm was not detected. It is recommended
        to use the bcache-tuning charm to ensure optimal bcache configuration.
