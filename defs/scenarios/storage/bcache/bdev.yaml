checks:
  bcache_enabled:
    requires:
      property: hotsos.core.plugins.storage.bcache.BcacheBase.bcache_enabled
  has_invalid_bdev_config:
    requires:
      config:
        handler: hotsos.core.plugins.storage.bcache.BdevsConfig
        invert-result: True
        assertions:
          sequential_cutoff:
            ops: [[eq, '0.0k']]
          cache_mode:
            ops: [[eq, 'writethrough [writeback] writearound none']]
          writeback_percent:
            ops: [[ge, 10]]
conclusions:
  invalid-bdev-config:
    decision:
      and:
        - bcache_enabled
        - has_invalid_bdev_config
    raises:
      type: hotsos.core.issues.BcacheWarning
      message: >-
        bcache config {key} expected to be {op} but actual={value_actual}.
      format-dict:
        key: '@checks.has_invalid_bdev_config.requires.key'
        op: '@checks.has_invalid_bdev_config.requires.ops'
        value_actual: '@checks.has_invalid_bdev_config.requires.value_actual'
