checks:
  octavia_worker_installed:
    requires:
      and:
        - property: hotsos.core.plugins.openstack.OctaviaBase.installed
        - systemd: octavia-worker
  hm_port_packet_errors_drops:
    requires:
      property:
        path: hotsos.core.plugins.openstack.OctaviaBase.hm_port_healthy
        ops: [[not_]]
  hm_port_address_check:
    requires:
      property:
        path: hotsos.core.plugins.openstack.OctaviaBase.hm_port_has_address
        ops: [[not_]]
conclusions:
  no-addr-or-noexist:
    priority: 1
    decision:
      and:
        - octavia_worker_installed
        - hm_port_address_check
    raises:
      type: hotsos.core.issues.OpenstackError
      message: >-
        Octavia health manager port {name} does not have an ip address
        configured which means octavia services on this host will not have
        access to the lb-management network and therefore will not be able
        to communicate with Amphora VMs - please investigate.
      format-dict:
        name: hotsos.core.plugins.openstack.OctaviaBase.OCTAVIA_HM_PORT_NAME
  packet-drops-errors:
    priority: 2
    decision:
      and:
        - octavia_worker_installed
        - hm_port_packet_errors_drops
    raises:
      type: hotsos.core.issues.OpenstackError
      message: >-
        Octavia health manager port {name} has some packets drops or errors -
        please investigate.
      format-dict:
        name: hotsos.core.plugins.openstack.OctaviaBase.OCTAVIA_HM_PORT_NAME
