# Definitions for known-bug searches.
#
# This file allows you to define search criteria to match contents of files or
# command output that identify a known bug. When a match is found a bug issue
# is raised and displayed in the plugin output.
#
# The contents of this file are structured as follows:
#
# PLUGIN:
#   GROUP:
#     BUG_ID:
#       SETTINGS
#
# SETTINGS (for more info see core.ycheck.YBugChecker):
#
#   * expr: python.re regex pattern used to match line(s). this can be a single
#           pattern or a list of patterns.
#
#   * message: message displayed in output describing the bug/issue.
#
#   * input: our data source e.g. a log file or command
#
#  NOTE: see core.checks.YAMLDefInput for more info on support for input types.
#
#  NOTE: input can specified at the group, section or event level with the
#        lowest definition taking precedence.
#
# Optional:
#
#   * message-format-result-groups: optional list of python.re.match group ids
#     that are available when expr is matched and that we want to use as input
#     to a formatted message.
#
#   * hint: optional short pattern used as a pre-filter before trying expr.
#
# Bug Example:
#
#   1234567:
#     input:
#       type: filesystem
#       value: path/to/my/file
#     expr: <re.match pattern>
#     hint: optional <re.match pattern> used as a low-cost filter
#     message: this is a really bad bug
#
#
# TIP: to use a single quote ' inside a yaml string you need to replace it
#      with two single quotes.
#
openstack:
  nova:
    1888395:
      input:
        type: filesystem
        value: 'var/log/nova/nova-compute.log'
      expr: '.+NotImplementedError: Cannot load ''vifs'' in the base class'
      hint: 'NotImplementedError'
      message: 'known nova bug identified'
  neutron-l3-agent:
    input:
      type: filesystem
      value: 'var/log/neutron/neutron-l3-agent.log'
    1883089:
      expr: '.+AttributeError: ''NoneType'' object has no attribute ''get'''
      hint: 'AttributeError'
      message: 'known neutron l3-agent bug identified that affects dvr floating ips.'
    1929832:
      expr: '.+Error while deleting router \S+: \S+ProcessExecutionError: .+ /usr/bin/neutron-rootwrap: Unauthorized command: kill -15 \d+ \(no filter matched\)'
      hint: 'ProcessExecutionError'
      message: 'known neutron l3-agent bug identified that impacts deletion of neutron routers.'
    1927868:
      expr: '.+Gateway interface for router \S+ was not set up; router will not work properly'
      hint: 'Gateway'
      message: >-
        known neutron l3-agent bug identified that impacts HA routers and can
        cause router updates to stall.
    1896506:
      input:
        type: filesystem
        value: 'var/log/syslog'
      expr: '.+Unknown configuration entry ''no_track'' for ip address - ignoring.*'
      hint: 'no_track'
      message: >-
        known neutron l3-agent bug identified that critically impacts
        keepalived.
  neutron-agents-any:
    1907686:
      input:
        type: filesystem
        value: 'var/log/neutron/neutron-openvswitch-agent.log'
      expr: '.+OVS database connection to OVN_Northbound failed with error: ''Timeout''.+'
      hint: 'OVS database'
      message: >-
        known neutron-ovn bug identified that impacts OVN db connections.
    1928031:
      input:
        type: filesystem
        value: 'var/log/neutron/neutron-ovn-metadata-agent.log'
      expr: '.+AttributeError: ''MetadataProxyHandler'' object has no attribute ''sb_idl'''
      hint: 'AttributeError'
      message: >-
        known neutron-ovn bug identified that impacts OVN sbdb connections.
openvswitch:
  ovn:
    input:
      type: filesystem
      value: 'var/log/ovn/ovn-controller.log'
    1917475:
      expr: '.+transaction error: {"details":"RBAC rules for client \\"\S+\\" role \\"\S+\\" prohibit .+ table\s+\\"\S+\\".","error":"permission error"'
      hint: 'transaction error'
      message: 'known ovn bug identified - db rbac errors'
juju:
  common:
    input:
      type: filesystem
      value: 'var/log/juju/*.log'
    1910958:
      expr: '.* manifold worker .+ error: failed to initialize uniter for "(\S+)": cannot create relation state tracker: cannot remove persisted state, relation (\d+) has members'
      hint: 'manifold worker returned unexpected error'
      message: >-
        Unit {} failed to start due to members in relation {} that cannot be
        removed.
      message-format-result-groups: [1, 2]
    1858519:
      input:
        type: filesystem
        value: 'var/log/juju/unit-ceph-osd*.log'
      expr: '.* Cannot zap a device used by lvm'
      hint: 'Cannot zap'
      message: >-
        known ceph-osd charm bug identified - charm tried to zap a disk but
        failed since the disk has an LVM header. If you are sure the disk is
        not in active use by LVM, you may run pvremove on it before using it as
        an OSD - see LP bug for details.
rabbitmq:
  common:
    input:
      type: filesystem
      value:  'var/log/rabbitmq/rabbit@*.log'
    1943937:
      expr: 'operation queue.declare caused a channel exception not_found: failed to perform operation on queue ''\S+'' in vhost ''\S+'' due to timeout'
      hint: 'not_found'
      message: >-
        Known RabbitMQ issue where queues get stuck and clients trying to use
        them will just keep timing out. This stops many services in the cloud
        from working correctly. Resolution requires you to stop all RabbitMQ
        servers before starting them all again at the same time. A rolling
        restart or restarting them simultaneously will not work. See bug for
        more detail.

